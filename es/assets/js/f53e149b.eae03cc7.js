"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1014],{20990:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"s3-replication","title":"Replicaci\xf3n S3","description":"Configuraci\xf3n de replicaci\xf3n S3 entre cuentas","source":"@site/i18n/es/docusaurus-plugin-content-docs-tutorials/current/s3-replication.mdx","sourceDirName":".","slug":"/s3-replication","permalink":"/es/tutorial/s3-replication","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"S3","permalink":"/es/tutorial/tags/s-3"},{"inline":true,"label":"replication","permalink":"/es/tutorial/tags/replication"},{"inline":true,"label":"AWS","permalink":"/es/tutorial/tags/aws"},{"inline":true,"label":"cross-account","permalink":"/es/tutorial/tags/cross-account"},{"inline":true,"label":"data-sync","permalink":"/es/tutorial/tags/data-sync"},{"inline":true,"label":"backup","permalink":"/es/tutorial/tags/backup"},{"inline":true,"label":"storage","permalink":"/es/tutorial/tags/storage"}],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_label":"Replicaci\xf3n S3","sidebar_position":9,"title":"Replicaci\xf3n S3","description":"Configuraci\xf3n de replicaci\xf3n S3 entre cuentas","tags":["S3","replication","AWS","cross-account","data-sync","backup","storage"],"image":"/img/tutorial-img.png"},"sidebar":"tutorialsSidebar","previous":{"title":"Integraci\xf3n VPN de Terceros","permalink":"/es/tutorial/third-party-integration-vpn"},"next":{"title":"Django + Celery","permalink":"/es/tutorial/django-celery"}}');var s=i(74848),r=i(28453),l=(i(26393),i(42644));const c={sidebar_label:"Replicaci\xf3n S3",sidebar_position:9,title:"Replicaci\xf3n S3",description:"Configuraci\xf3n de replicaci\xf3n S3 entre cuentas",tags:["S3","replication","AWS","cross-account","data-sync","backup","storage"],image:"/img/tutorial-img.png"},t=void 0,o={},d=[{value:"1. Crear IAM Role en la cuenta donde est\xe1 el bucket de origen",id:"1-crear-iam-role-en-la-cuenta-donde-est\xe1-el-bucket-de-origen",level:2},{value:"Trust Policy",id:"trust-policy",level:3},{value:"Permissions Policy",id:"permissions-policy",level:3},{value:"2. Agregar pol\xedtica al bucket de destino",id:"2-agregar-pol\xedtica-al-bucket-de-destino",level:2},{value:"3. Configurar la regla de replicaci\xf3n en el bucket de origen",id:"3-configurar-la-regla-de-replicaci\xf3n-en-el-bucket-de-origen",level:2},{value:"Opcionales",id:"opcionales",level:2},{value:"Formas de copiar archivos ya existentes",id:"formas-de-copiar-archivos-ya-existentes",level:2},{value:"1. Hacerlo junto con la replicaci\xf3n",id:"1-hacerlo-junto-con-la-replicaci\xf3n",level:3},{value:"2. Usar la opci\xf3n de migraci\xf3n S3 que brinda Sleakops",id:"2-usar-la-opci\xf3n-de-migraci\xf3n-s3-que-brinda-sleakops",level:3},{value:"3. Usar el servicio de Batch Operation",id:"3-usar-el-servicio-de-batch-operation",level:3}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Pasos para configurar el servicio de S3 replication para replicar archivos de un bucket a otro en diferentes cuentas."}),"\n",(0,s.jsx)(n.p,{children:"Como requisito es necesario tener en ambos buckets el versionado activo."}),"\n",(0,s.jsx)(n.h2,{id:"1-crear-iam-role-en-la-cuenta-donde-est\xe1-el-bucket-de-origen",children:"1. Crear IAM Role en la cuenta donde est\xe1 el bucket de origen"}),"\n",(0,s.jsx)(n.h3,{id:"trust-policy",children:"Trust Policy"}),"\n",(0,s.jsx)(n.p,{children:"Necesitas una pol\xedtica de confianza que permita al servicio S3 asumir el rol:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": "s3.amazonaws.com"\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"permissions-policy",children:"Permissions Policy"}),"\n",(0,s.jsx)(n.p,{children:"Una pol\xedtica de permisos que permita:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Leer objetos y metadatos del bucket de origen (Cuenta A)."}),"\n",(0,s.jsx)(n.li,{children:"Poner (put) objetos en el bucket de destino (Cuenta B)."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "ReadSourceBucket",\n      "Effect": "Allow",\n      "Action": [\n        "s3:GetObject",\n        "s3:GetObjectAcl",\n        "s3:GetObjectVersion",\n        "s3:GetObjectVersionAcl"\n      ],\n      "Resource": "arn:aws:s3:::<NOMBRE_BUCKET_ORIGEN>/*"\n    },\n    {\n      "Sid": "WriteDestBucket",\n      "Effect": "Allow",\n      "Action": [\n        "s3:PutObject",\n        "s3:PutObjectAcl",\n        "s3:ReplicateObject",\n        "s3:ReplicateDelete",\n        "s3:ReplicateTags",\n        "s3:GetObjectVersionTagging",\n        "s3:PutObjectVersionTagging"\n      ],\n      "Resource": "arn:aws:s3:::<NOMBRE_BUCKET_DESTINO>/*"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"2-agregar-pol\xedtica-al-bucket-de-destino",children:"2. Agregar pol\xedtica al bucket de destino"}),"\n",(0,s.jsx)(n.p,{children:"Dentro del detalle del bucket de destino, ir a la pesta\xf1a de permisos y agregar la siguiente pol\xedtica:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "AllowReplicationFromAccountA",\n      "Effect": "Allow",\n      "Principal": {\n        "AWS": "arn:aws:iam::<ID_CUENTA_A>:role/<NOMBRE_DE_LA_ROLE>"\n      },\n      "Action": [\n        "s3:PutObject",\n        "s3:PutObjectAcl",\n        "s3:ReplicateObject",\n        "s3:ReplicateDelete",\n        "s3:ReplicateTags"\n      ],\n      "Resource": ["arn:aws:s3:::<NOMBRE_BUCKET_DESTINO>/*"]\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"3-configurar-la-regla-de-replicaci\xf3n-en-el-bucket-de-origen",children:"3. Configurar la regla de replicaci\xf3n en el bucket de origen"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:['En el detalle del bucket de origen, ir a la pesta\xf1a "Management" (o "Properties" seg\xfan versi\xf3n de la consola) y buscar la secci\xf3n de ',(0,s.jsx)(n.strong,{children:"Replication"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Crear una nueva regla de replicaci\xf3n y definir:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rule name"}),": Un nombre descriptivo."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": Enabled (habilitada)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Source bucket"}),": El bucket actual (ya est\xe1 seleccionado)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Prefix/Filter"}),": Puedes elegir replicar todo el bucket o solo un prefijo en particular."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Destination"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bucket"}),": especificar el ",(0,s.jsx)(n.strong,{children:"ARN"})," del bucket de destino en la Cuenta B."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"IAM role"}),": elegir el rol que creaste en el primer paso, que permite la replicaci\xf3n."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"opcionales",children:"Opcionales"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:['Si se activa la opci\xf3n de "Transfer to destination bucket owner" debe agregarse, tanto en AllowReplicationFromAccountA (pol\xedtica del bucket destino) como en WriteDestBucket (IAM role), la action:\n',(0,s.jsx)(n.code,{children:'"s3:ObjectOwnerOverrideToBucketOwner"'})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"formas-de-copiar-archivos-ya-existentes",children:"Formas de copiar archivos ya existentes"}),"\n",(0,s.jsx)(n.p,{children:"Existen 3 maneras diferentes de copiar los archivos ya existentes del bucket:"}),"\n",(0,s.jsx)(n.h3,{id:"1-hacerlo-junto-con-la-replicaci\xf3n",children:"1. Hacerlo junto con la replicaci\xf3n"}),"\n",(0,s.jsx)(n.p,{children:"Al activar la replicaci\xf3n, te da una opci\xf3n para copiar todos los archivos existentes."}),"\n",(0,s.jsx)(n.h3,{id:"2-usar-la-opci\xf3n-de-migraci\xf3n-s3-que-brinda-sleakops",children:"2. Usar la opci\xf3n de migraci\xf3n S3 que brinda Sleakops"}),"\n",(0,s.jsx)(n.p,{children:"En el detalle de la dependencia de tipo S3, se puede encontrar esta funci\xf3n donde te gu\xeda paso a paso lo que se tiene que hacer."}),"\n",(0,s.jsx)(n.h3,{id:"3-usar-el-servicio-de-batch-operation",children:"3. Usar el servicio de Batch Operation"}),"\n",(0,s.jsx)(n.p,{children:"Una vez creada la regla de replicaci\xf3n, siguiendo estas gu\xedas:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.HaR,{})," ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/batch-ops-iam-role-policies.html",children:"Batch Operations IAM role\npolicies"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.HaR,{})," ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/replication-metrics-events.html",children:"Replication metrics and\nevents"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Agregar a la pol\xedtica S3ReplicationRolePolicy las siguientes acciones:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'"s3:PutObjectTagging"'})," al ",(0,s.jsx)(n.code,{children:'"Sid": "WriteDestBucket"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'"s3:GetObjectTagging"'})," y ",(0,s.jsx)(n.code,{children:'"s3:ListBucket"'})," al ",(0,s.jsx)(n.code,{children:'"Sid": "ReadSourceBucket"'})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Sid": "ReadReportBucket",\n  "Effect": "Allow",\n  "Action": ["s3:GetObject", "s3:GetObjectVersion"],\n  "Resource": ["arn:aws:s3:::bucket-reports/*"]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Y agregar tanto a WriteDestBucket como SourceBucket el permiso ",(0,s.jsx)(n.code,{children:'"s3:InitiateReplication"'}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},26393:()=>{},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var a=i(96540);const s={},r=a.createContext(s);function l(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);