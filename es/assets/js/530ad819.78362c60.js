"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5696],{68989:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>g,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"third-party-integration-vpn","title":"Third Party VPN Integration","description":"Comparison of VPN alternatives in AWS","source":"@site/tutorials/third-party-integration-vpn.mdx","sourceDirName":".","slug":"/third-party-integration-vpn","permalink":"/es/tutorial/third-party-integration-vpn","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"VPN","permalink":"/es/tutorial/tags/vpn"},{"inline":true,"label":"AWS","permalink":"/es/tutorial/tags/aws"},{"inline":true,"label":"third-party","permalink":"/es/tutorial/tags/third-party"},{"inline":true,"label":"networking","permalink":"/es/tutorial/tags/networking"},{"inline":true,"label":"connectivity","permalink":"/es/tutorial/tags/connectivity"},{"inline":true,"label":"cost-analysis","permalink":"/es/tutorial/tags/cost-analysis"},{"inline":true,"label":"transit-gateway","permalink":"/es/tutorial/tags/transit-gateway"}],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Third Party VPN Integration","sidebar_label":"Third Party VPN Integration","sidebar_position":8,"description":"Comparison of VPN alternatives in AWS","tags":["VPN","AWS","third-party","networking","connectivity","cost-analysis","transit-gateway"],"image":"/img/tutorials/third-party-integration-vpn/third-party-integration-vpn.png"},"sidebar":"tutorialsSidebar","previous":{"title":"S3 Batch","permalink":"/es/tutorial/s3-batch"},"next":{"title":"S3 Replication","permalink":"/es/tutorial/s3-replication"}}');var s=e(74848),r=e(28453),a=e(34028),o=(e(26393),e(42644));const l={title:"Third Party VPN Integration",sidebar_label:"Third Party VPN Integration",sidebar_position:8,description:"Comparison of VPN alternatives in AWS",tags:["VPN","AWS","third-party","networking","connectivity","cost-analysis","transit-gateway"],image:"/img/tutorials/third-party-integration-vpn/third-party-integration-vpn.png"},c=void 0,d={},h=[{value:"Transit Gateway (~$197/month in the described scenario)",id:"transit-gateway-197month-in-the-described-scenario",level:3},{value:"Site-to-Site VPN + EC2 (~$80/month estimated)",id:"site-to-site-vpn--ec2-80month-estimated",level:3},{value:"VPN on EC2 (StrongSwan + Nginx) (~$20\u201321/month with 1 instance, or ~$40\u201342/month for HA)",id:"vpn-on-ec2-strongswan--nginx-2021month-with-1-instance-or-4042month-for-ha",level:3},{value:"Transit Gateway",id:"transit-gateway",level:2},{value:"Cost Analysis",id:"cost-analysis",level:3},{value:"Site-to-Site VPN",id:"site-to-site-vpn",level:2},{value:"Cost Analysis",id:"cost-analysis-1",level:3},{value:"VPN on EC2",id:"vpn-on-ec2",level:2},{value:"Cost Analysis",id:"cost-analysis-2",level:3}];function p(n){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["The choice between these three alternatives is based on the balance between ",(0,s.jsx)(t.strong,{children:"costs"}),",** scalability** and ",(0,s.jsx)(t.strong,{children:"management complexity"}),":"]}),"\n",(0,s.jsx)(t.h3,{id:"transit-gateway-197month-in-the-described-scenario",children:"Transit Gateway (~$197/month in the described scenario)"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Higher fixed cost per attachment."}),"\n",(0,s.jsx)(t.li,{children:"Excellent option for larger topologies, multiple VPCs and scalability with minimal routing complexity."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"site-to-site-vpn--ec2-80month-estimated",children:"Site-to-Site VPN + EC2 (~$80/month estimated)"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Easy configuration (native AWS solution)."}),"\n",(0,s.jsx)(t.li,{children:"Suitable for a moderate number of tunnels, although less flexible than TGW for large topologies."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"vpn-on-ec2-strongswan--nginx-2021month-with-1-instance-or-4042month-for-ha",children:"VPN on EC2 (StrongSwan + Nginx) (~$20\u201321/month with 1 instance, or ~$40\u201342/month for HA)"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Significantly lower cost."}),"\n",(0,s.jsx)(t.li,{children:"Higher administration and maintenance complexity (instance management, patches, manual failover)."}),"\n",(0,s.jsx)(t.li,{children:"Suitable if total traffic is low and if you have staff to operate/monitor the instance."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"transit-gateway",children:"Transit Gateway"}),"\n",(0,s.jsx)(t.p,{children:"Acts as a centralized router that allows interconnection between multiple VPCs, on-premises networks and third-party networks."}),"\n",(0,s.jsx)(t.p,{children:"VPN connections are established through IPsec tunnels, which can be configured to provide high availability and redundancy (two tunnels per VPN connection are generally configured to achieve automatic failover)."}),"\n",(0,s.jsx)(a.A,{overlayBgColorEnd:"rgba(255, 255, 255, 0.8)",children:(0,s.jsx)("img",{src:"/img/tutorials/third-party-integration-vpn/vpn.png",alt:"vpn"})}),"\n",(0,s.jsx)(t.h3,{id:"cost-analysis",children:"Cost Analysis"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Hypothesis:"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"3 attachments"})," in the Transit Gateway, corresponding for example to:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"VPC (Dev)"}),"\n",(0,s.jsx)(t.li,{children:"VPN (Prod)"}),"\n",(0,s.jsx)(t.li,{children:"VPN (Contingency)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"730 hours"})," of monthly usage (24/7)."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"2 GB monthly transfer"})," per attachment, totaling ",(0,s.jsx)(t.strong,{children:"6 GB monthly"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"AWS rates (in most regions):"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"$0.09/hour/attachment"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"$0.002/GB"})," of data transfer.\n",(0,s.jsx)(t.strong,{children:"Costs:"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Attachment costs"}),": ~$197.10/month"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Data transfer cost"}),": ~$0.01/month\n",(0,s.jsx)(t.strong,{children:"Total sum"}),": ~$197.11/month (rounded to ~$197.22/month in the original example)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"site-to-site-vpn",children:"Site-to-Site VPN"}),"\n",(0,s.jsxs)(t.p,{children:["A Site-to-Site VPN connection offers two VPN tunnels between a virtual ",(0,s.jsx)(t.strong,{children:"private gateway"})," or ",(0,s.jsx)(t.strong,{children:"transit gateway"})," on the AWS side and a ",(0,s.jsx)(t.strong,{children:"customer gateway"})," on the remote side (on-premise)."]}),"\n",(0,s.jsxs)(t.p,{children:["Two tunnels for automatic failover or maintenance that AWS usually does that could briefly disable one of the tunnels \u2014> ",(0,s.jsx)(o.HaR,{})," ",(0,s.jsx)(t.a,{href:"https://docs.aws.amazon.com/vpn/latest/s2svpn/endpoint-replacements.html",children:"Site-to-Site VPN tunnel endpoint replacement"})]}),"\n",(0,s.jsx)(a.A,{overlayBgColorEnd:"rgba(255, 255, 255, 0.8)",children:(0,s.jsx)("img",{src:"/img/tutorials/third-party-integration-vpn/vpn-2.png",alt:"vpn-2"})}),"\n",(0,s.jsx)(a.A,{overlayBgColorEnd:"rgba(255, 255, 255, 0.8)",children:(0,s.jsx)("img",{src:"/img/tutorials/third-party-integration-vpn/vpn-3.png",alt:"vpn-3"})}),"\n",(0,s.jsx)(t.h3,{id:"cost-analysis-1",children:"Cost Analysis"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Hypothesis:"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"3 connections (VPN)"}),' (equivalent to the 3 "attachments" you mentioned: Dev, Main, Contingency).']}),"\n",(0,s.jsx)(t.li,{children:"Each VPN is an AWS-managed Site-to-Site tunnel."}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Site-to-Site VPN cost"}),": $0.05 per hour per VPN"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"730 hours"})," monthly (24/7)."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"2 GB monthly transfer"})," per VPN.\n",(0,s.jsx)(t.strong,{children:"Costs:"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"VPN"})," (3 connections): ~$109.50"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Data transfer"})," (6 GB total): ~$0.54"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Network Load Balancer"}),": ~$20\u201325\n",(0,s.jsx)(t.strong,{children:"Total sum"}),": ~$130\u2013135 monthly."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"vpn-on-ec2",children:"VPN on EC2"}),"\n",(0,s.jsxs)(t.p,{children:["In this solution, an EC2 instance is launched on which ",(0,s.jsx)(t.strong,{children:"StrongSwan"})," is installed to establish IPsec tunnels and ",(0,s.jsx)(t.strong,{children:"Nginx"})," as a proxy (normally to route traffic at the application layer towards an Application Load Balancer or other VPC resources)."]}),"\n",(0,s.jsx)(a.A,{overlayBgColorEnd:"rgba(255, 255, 255, 0.8)",children:(0,s.jsx)("img",{src:"/img/tutorials/third-party-integration-vpn/vpn-4.png",alt:"vpn-4"})}),"\n",(0,s.jsx)(t.h3,{id:"cost-analysis-2",children:"Cost Analysis"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Hypothesis:"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"3 tunnels (VPN)"})," configured on the same instance (or on two instances for redundancy)."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"EC2 instance"})," of small size, for example, ",(0,s.jsx)(t.strong,{children:"t3.small"})," (with approx. cost $0.02\u20130.023/h).\n",(0,s.jsx)(t.strong,{children:"Costs:"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"EC2 + EBS"}),": ~$18\u201320/month (1 instance)"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Data transfer"}),": ~$0.54/month\n",(0,s.jsx)(t.strong,{children:"Total sum"}),": ~$20\u201321/month (In case of 2 instances for HA => ~$40\u201342/month.)"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Configuration of nginx and ipsec to achieve the connection setup.\n",(0,s.jsx)(t.strong,{children:"nginx.conf"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-nginx",children:'load_module /usr/lib/nginx/modules/ngx_stream_module.so;\nworker_processes  1;\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n    access_log  /var/log/nginx/access.log  main;\n    sendfile        on;\n    keepalive_timeout  65;\n    server_tokens off;\n}\n\nstream {\n    server {\n        listen 8180;\n        proxy_pass **<URL-ALB>**;\n    }\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"iptables.conf"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"*mangle\n:PREROUTING ACCEPT [8165:7991805]\n:INPUT ACCEPT [7883:7958068]\n:FORWARD ACCEPT [282:33737]\n:OUTPUT ACCEPT [5933:572312]\n:POSTROUTING ACCEPT [6215:606049]\nCOMMIT\n  *nat\n:PREROUTING ACCEPT [159:9540]\n:INPUT ACCEPT [159:9540]\n:OUTPUT ACCEPT [168:10720]\n:POSTROUTING ACCEPT [168:10720]\n-A PREROUTING -i eth0 -p tcp -m tcp --dport 2222 -j DNAT --to-destination <IP-BIND>:22\n-A PREROUTING -i eth0 -p tcp -m tcp --dport 443 -j DNAT --to-destination <IP-BIND>:443\n-A POSTROUTING -p tcp -m tcp --dport 22 -j SNAT --to-source <IP-TUNNEL-BIND>\n-A POSTROUTING -p tcp -m tcp --dport 443 -j SNAT --to-source <IP-TUNNEL-BIND>\nCOMMIT\n  *filter\n:INPUT ACCEPT [6016:538920]\n:FORWARD ACCEPT [123:22565]\n:OUTPUT ACCEPT [4614:432344]\n-A FORWARD -d <IP-BIND>/32 -p tcp -m tcp --dport 443 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT\n-A FORWARD -d <IP-BIND>/32 -p tcp -m tcp --dport 22 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT\n-A FORWARD -d <IP-BIND>/32 -p tcp -m tcp --dport 44301 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT\n-A FORWARD -d <IP-BIND>/32 -p tcp -m tcp --dport 22 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT\n-A FORWARD -d <IP-BIND>/32 -p tcp -m tcp --dport 8180 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT\nCOMMIT\n"})})]})}function g(n={}){const{wrapper:t}={...(0,r.R)(),...n.components};return t?(0,s.jsx)(t,{...n,children:(0,s.jsx)(p,{...n})}):p(n)}},26393:()=>{}}]);