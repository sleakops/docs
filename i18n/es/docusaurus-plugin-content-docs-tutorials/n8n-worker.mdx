---
sidebar_label: "n8n + Worker Mode"
sidebar_position: 2
title: "n8n + Worker Mode"
description: "Aprende c√≥mo desplegar tu proyecto n8n con modo worker distribuido y escalable en Kubernetes usando Sleakops"
tags:
  - n8n
  - kubernetes
  - worker
  - scaling
  - automation
  - background-jobs
  - deployment
image: /img/tutorial-img.png
---

import Zoom from "react-medium-image-zoom";
import "react-medium-image-zoom/dist/styles.css";
import { FiExternalLink } from "react-icons/fi";

Aprende c√≥mo desplegar tu proyecto n8n con modo worker distribuido y escalable en Kubernetes usando Sleakops.

## Prerrequisitos

- Cuenta en Sleakops
- Un Cl√∫ster en esta cuenta. Si no lo tienes, [aqu√≠ est√° la documentaci√≥n sobre c√≥mo hacerlo](/cluster).
- Un Ambiente configurado. Si no lo tienes, [aqu√≠ est√° la documentaci√≥n sobre c√≥mo hacerlo](/environment).
- Proyecto n8n configurado con Docker.

## Empecemos

Para este ejemplo, vamos a desplegar un proyecto n8n en modo distribuido con procesos worker. Esta configuraci√≥n incluye el servicio principal de n8n (interfaz web) y procesos worker para ejecutar workflows. Tambi√©n vamos a configurar una base de datos PostgreSQL y Redis para la gesti√≥n de colas, que son necesarios para este proyecto.

### Crear un proyecto

Los proyectos son nuestros repositorios de c√≥digo. Todo lo que Sleakops necesita para ejecutar comandos es un Dockerfile.

Para m√°s informaci√≥n, consulta nuestra documentaci√≥n de proyectos.

Para comenzar, vamos a crear un nuevo proyecto:

En la pantalla de creaci√≥n de proyecto tenemos los siguientes campos:

| Configuraci√≥n   | Descripci√≥n                                                                |
| --------------- | -------------------------------------------------------------------------- |
| Environment     | Necesitamos seleccionar el ambiente creado previamente.                    |
| Nodepool        | Dejaremos el predeterminado.                                               |
| Repositories    | Seleccionaremos nuestro repositorio que contiene el proyecto n8n.          |
| Project Name    | Podemos definir un nombre de proyecto. Por ejemplo, "n8n-server".          |
| Branch          | Debe coincidir con la rama en nuestro proyecto. En nuestro caso es "main". |
| Dockerfile path | Esta es la ruta relativa al Dockerfile en tu proyecto.                     |

Una vez configurado todo eso, creamos el proyecto con el bot√≥n "Submit" en la parte inferior derecha.

### Crear un Servicio Web

En esta p√°gina vamos a completar el primer formulario con los siguientes campos:

| Configuraci√≥n | Descripci√≥n                                                                      |
| ------------- | -------------------------------------------------------------------------------- |
| Project       | Seleccionamos el proyecto que creamos previamente, en nuestro caso "n8n-server". |
| Name          | Definimos un nombre para el servicio web, por ejemplo "n8n-main".                |
| Command       | Comando por defecto del Dockerfile (usualmente n8n start).                       |
| Port          | Puerto 5678 (puerto por defecto de n8n).                                         |

En el segundo paso, configuraremos el servicio web como **privado**.

### Crear un Worker

En la pantalla de creaci√≥n de workers tendremos que completar los siguientes campos:

| Configuraci√≥n | Descripci√≥n                                                                     |
| ------------- | ------------------------------------------------------------------------------- |
| Project       | Seleccionar el proyecto creado previamente. En nuestro caso "n8n-server".       |
| Name          | Definimos el nombre que le vamos a dar al worker. En nuestro caso "n8n-worker". |
| Command       | Aqu√≠ establecemos el comando para ejecutar el worker de n8n: `worker`           |

Con estos campos completados haremos clic en el bot√≥n "Next" en la parte inferior derecha y luego "Submit" ya que no necesitamos editar nada m√°s.

## Configurar Dependencias

Primero, necesitamos crear una dependencia de Redis para la cola de tareas. En la pantalla de creaci√≥n de dependencias, selecciona Redis y ver√°s los siguientes campos:

| Configuraci√≥n   | Descripci√≥n                                                               |
| --------------- | ------------------------------------------------------------------------- |
| Dependency Type | Seleccionar "Redis" de las opciones disponibles.                          |
| Project         | Seleccionar el proyecto creado previamente. En nuestro caso "n8n-server". |
| Name            | Definir el nombre para Redis. En nuestro caso "n8n-redis".                |

Con estos campos completados, haremos clic en el bot√≥n "Next" en la parte inferior derecha. En el √∫ltimo paso, antes de hacer clic en "Submit", cambiaremos los nombres de las variables de entorno para que coincidan con lo que n8n espera.

Necesitamos configurar las variables de conexi√≥n de Redis para que coincidan con lo que n8n espera:

| Variable              | Valor                          |
| --------------------- | ------------------------------ |
| QUEUE_BULL_REDIS_HOST | (Host de la dependencia Redis) |
| QUEUE_BULL_REDIS_PORT | 6379                           |

Al igual que con Redis, necesitamos configurar los nombres de las variables de entorno seg√∫n lo que n8n espera. Ve al √∫ltimo paso y antes de hacer clic en submit, cambia los nombres a los siguientes:

| Antes                   | Despu√©s                |
| ----------------------- | ---------------------- |
| \*\_POSTGRESQL_NAME     | DB_POSTGRESDB_DATABASE |
| \*\_POSTGRESQL_USERNAME | DB_POSTGRESDB_USER     |
| \*\_POSTGRESQL_PASSWORD | DB_POSTGRESDB_PASSWORD |
| \*\_POSTGRESQL_ADDRESS  | DB_POSTGRESDB_HOST     |
| \*\_POSTGRESQL_PORT     | DB_POSTGRESDB_PORT     |

Deber√≠a verse similar a la imagen de abajo. Luego haz clic en el bot√≥n "Submit" y se crear√° tu base de datos.

## Despliegues

Como √∫ltimo paso vamos a ver nuestro proyecto desplegado. Para esto vamos a la secci√≥n "Deployments" del panel izquierdo.

Aqu√≠ vamos a ver todos los despliegues que hacemos. En nuestro caso es el primero y podemos ver que se ha creado correctamente. En caso de que veas alg√∫n error si haces clic en "error" puedes ver una descripci√≥n del mismo.
Si no vemos ning√∫n error entonces significa que el proyecto ya est√° desplegado.

Esto concluye nuestro proceso de despliegue de proyecto n8n con modo worker.

## Configuraci√≥n CI/CD (Opcional pero Recomendado)

### ¬øPor qu√© configurar CI/CD?

Sin CI/CD, cada cambio en tu c√≥digo requiere:

1. Build manual desde SleakOps
2. Despliegue manual
3. Verificaci√≥n manual

Con CI/CD configurado:

- ‚úÖ Push a `main` ‚Üí Despliegue autom√°tico
- ‚úÖ Rollback autom√°tico en caso de error
- ‚úÖ Notificaciones de estado de despliegue

### Pasos de configuraci√≥n:

1. Ve a tu proyecto en SleakOps
2. Haz clic en ‚öôÔ∏è (configuraci√≥n)
3. Selecciona "Git pipelines"
4. Copia el archivo YAML proporcionado
5. Agrega `SLEAKOPS_KEY` a tus secrets de GitHub

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
  <img
    src="/img/quickstart/n8n/cicd-1.png"
    alt="click-settings-project-reference"
  />
</Zoom>

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
  <img
    src="/img/quickstart/n8n/cicd-2.png"
    alt="click-git-pipelines-reference"
  />
</Zoom>

Esto requiere una variable de entorno llamada SLEAKOPS_KEY. Si no la tienes, ve al enlace proporcionado en **Settings -> CLI**, obt√©nla y gu√°rdala como una variable de entorno.

Con esto configurado y desplegado, cada vez que hagas push a tu rama "main", se lanzar√° autom√°ticamente una nueva versi√≥n de tu aplicaci√≥n.

## üéØ Pr√≥ximos Pasos

Una vez completada la instalaci√≥n:

### Configuraci√≥n Inicial de n8n

1. **Primer Acceso**: Usa la URL de tu servicio web
2. **Crear Usuario Administrador**: n8n te pedir√° crear el primer usuario
3. **Configurar Webhooks**: Si es necesario, configura las URLs p√∫blicas

### Monitoreo y Optimizaci√≥n

1. **Revisar M√©tricas**: Usa el dashboard integrado de Grafana
2. **Ajustar Recursos**: Modifica CPU/memoria basado en el uso real
3. **Configurar Alertas**: Define umbrales de rendimiento

### Backup y Seguridad

1. **Backups Autom√°ticos**: Configura backups de PostgreSQL
2. **Gesti√≥n de Secretos**: Revisa la gesti√≥n de credenciales
3. **Actualizaciones**: Programa actualizaciones regulares

## Actualizar y Extender n8n

Ahora tenemos nuestro propio n8n instalado y ejecut√°ndose en el cl√∫ster. Tenemos nuestra definici√≥n de n8n en un Dockerfile.

#### Para actualizar la versi√≥n

Este proceso es muy simple. Modificaremos el Dockerfile y cambiaremos el tag de la imagen. Puedes ver las im√°genes disponibles en el repositorio oficial de n8n en Docker Hub.

Nota: Lee el changelog por si hay cambios disruptivos o algo que pueda romperse entre versiones. Haz backups de la base de datos antes, por si acaso.

#### Para agregar nuevas dependencias a tus nodos

Como hicimos para actualizar la versi√≥n, en este caso aprovecharemos tener nuestro Dockerfile e instalaremos lo que queramos dentro de √©l. Esto estar√° disponible para usar en nuestros nodos de n8n.

Puedes ver ejemplos de esto en el README del repositorio.

## Mejores Pr√°cticas de Escalado (Bonus)

Una vez que tu despliegue de n8n est√© funcionando, considera estas estrategias de escalado:

### üéØ **Optimizaci√≥n de Workers**

- **Monitoreo de Cola**: Monitoriza la profundidad de la cola de Redis para determinar cu√°ndo escalar workers.
- **Asignaci√≥n de Recursos**: Asigna suficiente CPU y memoria basado en la complejidad del workflow.
- **Ajuste de Concurrencia**: Ajusta la concurrencia de workers basado en tipos de workflow (intensivo en CPU vs. I/O).
- **Workers Dedicados**: Crea pools de workers especializados para diferentes categor√≠as de workflow.

### üìà **Monitoreo de Rendimiento**

Ajusta la memoria y CPU de tus workloads a lo que tus procesos realmente necesitan.

Esto es √∫til para evitar infraestructura sobredimensionada y tambi√©n para tomar decisiones al escalar horizontalmente basado en memoria o CPU.

#### ¬øC√≥mo lo hacemos desde Sleakops?

Simple, ve a los detalles de tu worker o servicio web que creamos anteriormente y haz clic en el √≠cono "Grafana". Esto abrir√° un dashboard dentro de Grafana mostrando el consumo hist√≥rico de tu proceso. Aseg√∫rate de ver un rango de tiempo largo para cubrir todos tus escenarios.

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
  <img
    src="/img/quickstart/n8n/grafana-monitoring.png"
    alt="click-deployments-reference"
  />
</Zoom>

### üîß **Optimizaci√≥n de Base de Datos**

- **Connection Pooling**: Configura pools de conexiones PostgreSQL para alta concurrencia.

- **Read Replicas**: Usa read replicas para consultas de reporting y analytics. (Esto se puede hacer desde Sleakops en la configuraci√≥n de [Postgres](/project/dependency/postgresql-aws).)
- **Indexing**: Optimiza √≠ndices de base de datos para consultas de ejecuci√≥n de workflow.
- **Backup Strategies**: Implementa backups automatizados con recuperaci√≥n en un punto espec√≠fico del tiempo. (Esto se puede hacer desde Sleakops en la configuraci√≥n de [Postgres](/project/dependency/postgresql-aws).)

### üöÄ **Configuraciones Avanzadas**

- **Node Affinity**: Programa workers en tipos de nodos apropiados (optimizados para CPU vs. memoria). (Puedes hacer esto desde Sleakops usando [Nodepools](/cluster/nodepools))
- **Pod Disruption Budgets**: Garantiza disponibilidad m√≠nima durante mantenimiento del cl√∫ster. (Sleakops ya maneja esto)
- **Resource Quotas**: Establece l√≠mites apropiados para prevenir agotamiento de recursos. (Puedes hacer esto desde Sleakops definiendo l√≠mites en tus Workloads y Nodepools)
- **Network Policies**: Garantiza comunicaci√≥n entre pods. (Sleakops ya maneja esto)
