---
sidebar_position: 3
title: "Problemas de Resolución DNS en VPN con Kubeconfig"
description: "Solución para problemas de resolución DNS al conectar con clústeres EKS a través de VPN"
date: "2024-01-15"
category: "usuario"
tags: ["vpn", "dns", "kubeconfig", "pritunl", "ubuntu", "lens"]
---

import TroubleshootingItem from "@site/src/components/HomepageFeatures/troubleshootingitem";

# Problemas de Resolución DNS en VPN con Kubeconfig

**Fecha:** 15 de enero de 2024  
**Categoría:** Usuario  
**Etiquetas:** VPN, DNS, Kubeconfig, Pritunl, Ubuntu, Lens

## Descripción del Problema

**Contexto:** Los usuarios experimentan problemas de conectividad al intentar acceder a clústeres EKS mediante conexión VPN usando herramientas como Lens o kubectl. El problema está relacionado con conflictos en la resolución DNS entre el cliente VPN (Pritunl) y ciertas distribuciones de Linux como Ubuntu.

**Síntomas Observados:**

- No se puede conectar al clúster EKS a través de Lens a pesar de estar conectado a la VPN
- La resolución DNS falla para los endpoints del clúster EKS
- La conexión funciona con direcciones IP directas pero no con nombres DNS
- El problema ocurre específicamente en Ubuntu y distribuciones Linux similares

**Configuración Relevante:**

- Cliente VPN: Pritunl
- Sistema Operativo: Ubuntu (y distribuciones Linux similares)
- Acceso al Clúster: Clústeres EKS en AWS
- Herramientas: Lens, kubectl
- Método de Conexión: VPN + kubeconfig

**Condiciones de Error:**

- El error ocurre cuando la VPN está conectada
- La resolución DNS falla para endpoints EKS
- El problema persiste en diferentes clústeres (Dev/Prod)
- El problema es específico de la distribución (sistemas basados en Ubuntu)

## Solución Detallada

<TroubleshootingItem id="root-cause" summary="Entendiendo la causa raíz">

Este problema ocurre porque ciertas distribuciones Linux (particularmente Ubuntu) tienen conflictos en la configuración DNS al usar la VPN Pritunl. El sistema no puede resolver correctamente los nombres DNS del clúster EKS a través del túnel VPN, causando fallos en la conexión.

El problema afecta a:

- Ubuntu y distribuciones basadas en Ubuntu
- Sistemas con systemd-resolved
- Configuraciones donde las DNS de la VPN entran en conflicto con las DNS locales

</TroubleshootingItem>

<TroubleshootingItem id="ip-replacement-solution" summary="Reemplazar nombres DNS por direcciones IP en kubeconfig">

La solución más efectiva es reemplazar el endpoint DNS del clúster EKS por su dirección IP directa en el archivo kubeconfig.

**Pasos:**

1. **Ubica tu archivo kubeconfig** (usualmente en `~/.kube/config`)
2. **Encuentra la línea del servidor** que se ve así:
   ```yaml
   server: https://9CFEED5AD69EF4F87D19D6FF9FBF7AD9.gr7.us-east-1.eks.amazonaws.com
   ```
3. **Reemplázala con la dirección IP:**

   ```yaml
   # Para clúster de Producción
   server: https://10.130.96.192

   # Para clúster de Desarrollo
   server: https://10.110.98.134
   ```

4. **Guarda el archivo** y prueba la conexión

**Ejemplo de modificación en kubeconfig:**

```yaml
apiVersion: v1
clusters:
  - cluster:
      certificate-authority-data: LS0tLS1CRUdJTi...
      server: https://10.130.96.192 # Cambiado de DNS a IP
    name: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
contexts:
  - context:
      cluster: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
      user: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
    name: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
current-context: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
kind: Config
preferences: {}
users:
  - name: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
    user:
      exec:
        apiVersion: client.authentication.k8s.io/v1beta1
        command: aws
        args:
          - eks
          - get-token
          - --cluster-name
          - my-cluster
```

</TroubleshootingItem>

<TroubleshootingItem id="pritunl-dns-reset" summary="Alternativa: Restablecer configuración DNS en Pritunl">

Si el reemplazo por IP no funciona de forma permanente, puedes intentar restablecer la configuración DNS y la conexión de red en Pritunl:

**Pasos:**

1. **Abre el cliente Pritunl**
2. **Busca opciones de red** (usualmente en ajustes o opciones de conexión)
3. **Encuentra los botones para restablecer DNS** - debería haber opciones para:
   - Restablecer configuración DNS
   - Restablecer conexión de red
4. **Haz clic en ambos botones de restablecer**
5. **Reconéctate a la VPN**
6. **Prueba la conectividad al clúster**

**Nota:** Esta solución puede ser temporal y podría ser necesario repetirla periódicamente.

</TroubleshootingItem>

<TroubleshootingItem id="lens-configuration" summary="Configurar Lens con kubeconfig modificado">

Al usar Lens con el kubeconfig modificado:

**Pasos:**

1. **Asegúrate de que la VPN esté conectada** antes de abrir Lens
2. **Importa el kubeconfig modificado** con direcciones IP en lugar de nombres DNS
3. **Agrega el clúster en Lens** usando la configuración actualizada
4. **Prueba la conexión** - ahora deberías poder ver logs y recursos del clúster

**Solución de problemas en la conexión de Lens:**

- Verifica que la conexión VPN esté activa
- Comprueba que la dirección IP en kubeconfig coincida con tu entorno (Dev/Prod)
- Asegúrate que las credenciales AWS estén configuradas correctamente
- Intenta refrescar la conexión al clúster en Lens

</TroubleshootingItem>

<TroubleshootingItem id="environment-specific-ips" summary="Direcciones IP específicas por entorno">

**Importante:** Diferentes entornos usan diferentes direcciones IP. Asegúrate de usar la IP correcta para cada entorno:

**Entorno de Desarrollo:**

```yaml
server: https://10.110.98.134
```

**Entorno de Producción:**

```yaml
server: https://10.130.96.192
```

**Cómo obtener la IP correcta:**
Si necesitas encontrar la dirección IP para tu clúster específico:

1. Contacta al soporte de SleakOps para las direcciones IP actuales
2. O usa `nslookup` cuando no estés conectado a la VPN:
   ```bash
   nslookup your-cluster-endpoint.gr7.us-east-1.eks.amazonaws.com
   ```

</TroubleshootingItem>

<TroubleshootingItem id="permanent-solution" summary="Estado de la solución a largo plazo">

**Estado Actual:** El equipo de SleakOps está trabajando en una solución permanente para este problema de resolución DNS.

**Solución Temporal:** El método de reemplazo por dirección IP descrito arriba es la solución recomendada actualmente.

**Actualizaciones Futuras:** Cuando se implemente una solución permanente, los usuarios serán notificados y podrán volver a usar nombres DNS en sus archivos kubeconfig.

**Sistemas Afectados:**

- Ubuntu y distribuciones basadas en Ubuntu
- Sistemas que usan systemd-resolved
- Ciertas configuraciones de red que entran en conflicto con la VPN Pritunl

</TroubleshootingItem>

---

_Esta FAQ fue generada automáticamente el 15 de enero de 2024 basada en una consulta real de usuario._
