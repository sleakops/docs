import Zoom from "react-medium-image-zoom";
import "react-medium-image-zoom/dist/styles.css";
import { FiExternalLink } from "react-icons/fi";

# AWS Aurora PostgreSQL

SleakOps proporciona una integración perfecta con Amazon Aurora PostgreSQL, un servicio de base de datos relacional completamente administrado y compatible con PostgreSQL. Aurora PostgreSQL combina el rendimiento y la disponibilidad de bases de datos comerciales de alta gama con la simplicidad y rentabilidad de las bases de datos de código abierto. Al aprovechar SleakOps para esta integración, puedes gestionar eficientemente clústeres Aurora PostgreSQL dentro de tu entorno EKS, asegurando alto rendimiento, escalabilidad y confiabilidad para tus aplicaciones.

## Preguntas Frecuentes

<details>
<summary>
### ¿Cómo gestiona SleakOps las credenciales de Aurora PostgreSQL?
</summary>
Cuando creas una dependencia Aurora PostgreSQL en SleakOps, se genera automáticamente un Vargroup para tu clúster de base de datos. Este Grupo de Variables almacena de forma segura las credenciales de Aurora PostgreSQL y otros detalles importantes de configuración, como el endpoint del clúster y la información de acceso del usuario. Podrás gestionarlos desde la sección de [Vargroups](/project/vargroup/index.mdx).
</details>

<details>
<summary>
### ¿Puedo cambiar la versión de Aurora PostgreSQL después de desplegar el clúster?
</summary>
Sí, Aurora PostgreSQL soporta actualizaciones de versión del motor. Sin embargo, el proceso de actualización requiere planificación cuidadosa y puede involucrar tiempo de inactividad. Se recomienda probar el proceso de actualización en un entorno no productivo primero.
</details>

<details>
<summary>
### ¿Qué pasa si necesito más almacenamiento para mi clúster Aurora PostgreSQL?
</summary>
Aurora PostgreSQL escala automáticamente el almacenamiento de 10 GB hasta 128 TB sin requerir que provisiones almacenamiento por adelantado. El almacenamiento se escala automáticamente a medida que tus datos crecen, y solo pagas por el almacenamiento que uses.
</details>

<details>
<summary>
### ¿Cómo creo un dump de mi base de datos Aurora PostgreSQL?
</summary>
Para crear un dump de tu base de datos Aurora PostgreSQL:
1. **Ejecuta el comando `pg_dump`**:  
```
pg_dump -h AURORA_POSTGRESQL_ADDRESS -U AURORA_POSTGRESQL_USERNAME -W > dump.sql
```
Reemplaza `AURORA_POSTGRESQL_ADDRESS`, `AURORA_POSTGRESQL_USERNAME`, y `dump.sql` con los valores apropiados.
2. **Consulta la Documentación**: Para más información sobre cómo crear un dump, consulta la [documentación oficial de PostgreSQL <FiExternalLink/>](https://www.postgresql.org/docs/current/app-pgdump.html).
</details>

<details>
<summary>
### ¿Cómo importo un dump existente usando docker?
</summary>
Para importar un dump de base de datos a tu clúster Aurora PostgreSQL:  
1. **Conecta a la VPN**: Asegúrate de estar conectado a la VPN de la cuenta AWS donde se encuentra el clúster Aurora.
2. **Ejecuta Contenedor Docker** (Recomendado): 
   - Instala Docker en tu máquina local si no está instalado.  
   - Ejecuta un contenedor PostgreSQL Docker con el siguiente comando:
   ```
   docker run -it --name aurora-postgresql-container -v ./initial_data/:/tmp/data/ -e POSTGRESQL_ROOT_PASSWORD=AURORA_POSTGRESQL_PASSWORD -d postgres bash
   ```
   - Conecta a la terminal del contenedor:
   ```
   docker exec -t -i aurora-postgresql-container bash
   ```
   - Importa el archivo dump:
   ```
   psql -h AURORA_POSTGRESQL_ADDRESS -U AURORA_POSTGRESQL_USERNAME -W -f /tmp/data/dump.sql
   ```
   Reemplaza `AURORA_POSTGRESQL_ADDRESS`, `AURORA_POSTGRESQL_USERNAME`, y `dump.sql` con tus detalles específicos.
</details>

<details>
<summary>
### ¿Cómo importo un dump existente a mi máquina local?
</summary>
Alternativamente, puedes usar un cliente PostgreSQL instalado en tu máquina local para importar el dump:
```
psql -h AURORA_POSTGRESQL_ADDRESS -U AURORA_POSTGRESQL_USERNAME -W -f /tmp/data/dump.sql
```
</details>

<details>
<summary>
### ¿Qué debo hacer si encuentro problemas de conexión con mi clúster Aurora PostgreSQL?
</summary>
Verifica lo siguiente:
- Asegúrate de que el endpoint del clúster, nombre de usuario y contraseña sean correctos.
- Verifica que tus grupos de seguridad y reglas de firewall permitan el acceso.
- Asegúrate de que el clúster esté ejecutándose y tenga suficientes recursos (CPU, memoria).
- Verifica si el clúster está en estado disponible.
De lo contrario, contáctanos.
</details>

<details>
<summary>
### ¿Cuáles son los beneficios de Aurora PostgreSQL sobre PostgreSQL estándar en RDS?
</summary>
Aurora PostgreSQL ofrece varias ventajas:
- **Rendimiento**: Hasta 3x más rápido que PostgreSQL estándar en RDS
- **Escalabilidad**: Escalado automático de almacenamiento hasta 128 TB
- **Disponibilidad**: Respaldo continuo a S3 con recuperación punto en el tiempo
- **Durabilidad**: Replicación de 6 vías a través de 3 Zonas de Disponibilidad
- **Compatibilidad**: Compatible con PostgreSQL con cambios mínimos de código
</details>

:::info
Documentación de AWS: [Documentación de Amazon Aurora PostgreSQL](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/CHAP_AuroraPostgreSQL.html)
:::

## Configura tu Aurora PostgreSQL
### 1. Agrega Aurora PostgreSQL como Dependencia
Para integrar Aurora PostgreSQL con SleakOps:
1. En la consola de SleakOps, ve a la sección "Dependencies"
2. Elige "Aurora PostgreSQL" de la lista de tipos de dependencias disponibles. 
Para más detalles, consulta [Dependencies: Integrating Databases, Caching, and Messaging Services](/project/dependency/index.mdx).

### 2. Configura tu Aurora PostgreSQL.
Accederás al siguiente formulario:

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
<img
    src="/img/dependency/aurora-postgresql/aurora-postgresql-create-p1.png"
    alt="Formulario de creación de Aurora PostgreSQL"
/>
</Zoom>

Aquí están los parámetros que SleakOps te permite personalizar durante la creación:

| **Atributo** | **Descripción** |
| --- | --- |
| **Nombre de la Base de Datos** | Nombre para la base de datos Aurora PostgreSQL. Debe seguir el patrón: letras minúsculas y números, no puede ser "db" o "database". |
| **Versión del Motor de la Base de Datos** | Selecciona la versión específica del motor de la base de datos Aurora PostgreSQL. Elige entre las versiones soportadas. Cada versión incluye características específicas de PostgreSQL y actualizaciones de seguridad. |
| **Modo del Motor de la Base de Datos** | Aurora PostgreSQL está disponible solo en modo **Serverless**, que proporciona escalado automático basado en las necesidades de tu aplicación. Este modo escala la capacidad de cómputo hacia arriba y hacia abajo automáticamente, haciéndolo rentable para cargas de trabajo variables. |
| **Nombre de Usuario Maestro de la Base de Datos** | Nombre de usuario maestro para el clúster Aurora PostgreSQL. Este es el usuario principal con privilegios administrativos. No puede ser "admin", "user", "database", o "name". Debe comenzar con una letra y contener solo caracteres alfanuméricos. |
| **Auto-generar Contraseña** | Si está habilitado, el backend generará una contraseña segura automáticamente para mayor seguridad. Esto se recomienda para entornos de producción. |
| **Contraseña Maestra de la Base de Datos** | Contraseña para el usuario maestro. Requerida si auto-generar está deshabilitado. Debe tener al menos 8 caracteres y no puede contener caracteres @, ', ", o /. |
| **Capacidad Mínima de Aurora** | Unidades de Capacidad Mínima de Aurora (0.5-256) para el clúster serverless. Cada unidad es aproximadamente igual a 2GB de RAM. Esto establece el nivel de rendimiento base y asegura que los recursos mínimos estén siempre disponibles. |
| **Capacidad Máxima de Aurora** | Unidades de Capacidad Máxima de Aurora (1-256) para el clúster serverless. Cada unidad es aproximadamente igual a 2GB de RAM. Esto previene que el clúster escale más allá de los límites de tu presupuesto mientras permite la optimización del rendimiento. |
| **Período de Retención de Respaldo** | Número de días (1-35) para los cuales se mantienen los respaldos automáticos. Aurora PostgreSQL respalda automáticamente tu base de datos y almacena los respaldos en Amazon S3. Períodos de retención más largos proporcionan más opciones de recuperación pero aumentan los costos de almacenamiento. |
| **Ventana de Respaldo** | Período de tiempo para respaldos automatizados en formato HH:MM-HH:MM (UTC). Elige un momento cuando la actividad de tu base de datos típicamente sea baja para minimizar el impacto en el rendimiento. Aurora realiza respaldos durante esta ventana sin afectar tu aplicación. |
| **Réplicas de Lectura** | Configuración para réplicas de lectura de la base de datos para mejorar el rendimiento de lectura y proporcionar disponibilidad adicional. Cada réplica requiere un nombre único y puede configurarse como públicamente accesible o privada. Las réplicas de lectura ayudan a distribuir el tráfico de lectura y proporcionan capacidades de conmutación por error. |

### 3. Personaliza el nombre de tus variables para tu clúster Aurora PostgreSQL.

Como se explicó, cuando se crea una dependencia, SleakOps genera un vargroup para contener todos los atributos necesarios. 
En este paso puedes cambiar el nombre de los atributos en caso de que sea necesario. 
SleakOps completa los valores automáticamente. 
Después de este paso, tu dependencia es creada.

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
<img
    src="/img/dependency/aurora-postgresql/aurora-postgresql-create-outputs.png"
    alt="Salidas de creación de Aurora PostgreSQL"
/>
</Zoom>