---
sidebar_label: Gu√≠a de Delegaci√≥n de Dominios
---

# Gu√≠a de Delegaci√≥n de Dominios

Aprende c√≥mo delegar DNS correctamente para cada nivel de dominio en Sleakops.

---

## Descripci√≥n General

Cuando Sleakops crea una zona alojada, necesitas delegar el dominio actualizando los registros DNS en tu proveedor de dominios (registrador). Esta gu√≠a explica el proceso para cada nivel de dominio.

---

## Delegaci√≥n de Dominio del Proveedor

### Qu√© est√°s delegando
Tu dominio ra√≠z (por ejemplo, `sleakops.com`) a AWS Route 53 a trav√©s de Sleakops.

```mermaid
sequenceDiagram
    participant U as T√∫
    participant S as Sleakops
    participant R as Registrador de Dominio
    participant AWS as AWS Route 53
    
    U->>S: Crear Dominio del Proveedor
    S->>AWS: Crear Zona Alojada
    AWS-->>S: Devolver 4 Servidores de Nombres
    S-->>U: Mostrar Servidores de Nombres
    U->>R: Actualizar Servidores de Nombres
    R->>AWS: Delegar Autoridad DNS
    U->>S: Hacer clic en "Verificar Delegaci√≥n"
    S->>AWS: Verificar Delegaci√≥n
    AWS-->>S: Confirmaci√≥n
    S-->>U: ‚úÖ Delegaci√≥n Completa
```

### Pasos

1. **Crear el dominio del Proveedor en Sleakops**
   - Sleakops crea una zona alojada en AWS Route 53
   - Ver√°s una tabla con 4 registros de servidor de nombres (NS)

2. **Localizar los servidores de nombres**

```
ns-123.awsdns-12.com
ns-456.awsdns-45.net
ns-789.awsdns-78.org
ns-012.awsdns-01.co.uk
```


3. **Actualizar tu registrador de dominio**
   - Inicia sesi√≥n en tu registrador de dominio (GoDaddy, Namecheap, Google Domains, etc.)
   - Busca la configuraci√≥n DNS o de Servidores de nombres
   - Reemplaza los servidores de nombres existentes con los 4 servidores de nombres de AWS de Sleakops
   - Guardar cambios

4. **Verificar delegaci√≥n**
   - Hacer clic en el bot√≥n **"Verificar Delegaci√≥n"** en Sleakops
   - Esperar la propagaci√≥n DNS (puede tomar hasta 48 horas, usualmente m√°s r√°pido)
   - La marca verde indica delegaci√≥n exitosa

### Registradores Comunes

<details>
<summary><strong>GoDaddy</strong></summary>

1. Ve a [Administrador de Dominios](https://account.godaddy.com/products)
2. Haz clic en tu dominio
3. Despl√°zate hasta "Servidores de nombres" ‚Üí Haz clic en "Cambiar"
4. Selecciona "Ingresar mis propios servidores de nombres (avanzado)"
5. Agrega los 4 servidores de nombres de AWS
6. Guardar

</details>

<details>
<summary><strong>Namecheap</strong></summary>

1. Ve a [Lista de Dominios](https://ap.www.namecheap.com/domains/list/)
2. Haz clic en "Administrar" junto a tu dominio
3. Selecciona "DNS Personalizado" bajo Servidores de nombres
4. Agrega los 4 servidores de nombres de AWS
5. Haz clic en la marca verde

</details>

<details>
<summary><strong>Cloudflare</strong></summary>

**Nota:** Si usas Cloudflare, debes deshabilitar el proxy de Cloudflare para una delegaci√≥n adecuada.

1. Remover el dominio de Cloudflare, O
2. Actualizar servidores de nombres a AWS (elimina la gesti√≥n DNS de Cloudflare)

</details>

---

## Delegaci√≥n de Dominio del Entorno

### Qu√© est√°s delegando
Un subdominio (por ejemplo, `qa.sleakops.com`) a su propia zona alojada.

```mermaid
sequenceDiagram
    participant U as T√∫
    participant S as Sleakops
    participant R as Registrador de Dominio
    participant AWS as AWS Route 53
    
    U->>S: Crear Dominio del Proveedor
    S->>AWS: Crear Zona Alojada
    AWS-->>S: Devolver 4 Servidores de Nombres
    S-->>U: Mostrar Servidores de Nombres
    U->>R: Actualizar Servidores de Nombres
    R->>AWS: Delegar Autoridad DNS
    U->>S: Hacer clic en "Verificar Delegaci√≥n"
    S->>AWS: Verificar Delegaci√≥n
    AWS-->>S: Confirmaci√≥n
    S-->>U: ‚úÖ Delegaci√≥n Completa
```

### Dos Escenarios

#### Escenario A: El dominio padre ES administrado por Sleakops

```mermaid
graph LR
    A[sleakops.com<br/>en Sleakops] --> B[qa.sleakops.com<br/>en Sleakops]
    B --> C[‚úÖ Delegaci√≥n<br/>Autom√°tica]
    
    style A fill:#201f1f,stroke:#90cdf4,stroke-width:2px
    style B fill:#340f09,stroke:#594440,stroke-width:2px
    style C fill:#1a202c,stroke:#2e7d32,stroke-width:2px
```

**¬°Buenas noticias!** Sleakops crea autom√°ticamente los registros NS en la zona alojada padre.

‚úÖ **No se requiere acci√≥n** - la delegaci√≥n es autom√°tica

---

#### Escenario B: El dominio padre NO es administrado por Sleakops

```mermaid
graph LR
    A[sleakops.com<br/>DNS Externo] -.-> B[qa.sleakops.com<br/>en Sleakops]
    B --> C[‚ö†Ô∏è Registros NS<br/>Manuales Requeridos]
    
    style A fill:#594440,stroke:#c62828,stroke-width:2px
    style B fill:#340f09,stroke:#594440,stroke-width:2px
    style C fill:#1f2020,stroke:#e65100,stroke-width:2px
```

Si `sleakops.com` se administra fuera de Sleakops, pero quieres `qa.sleakops.com` en Sleakops:

1. **Crear el dominio del Entorno en Sleakops**
   - Sleakops crea una zona alojada
   - Ver√°s 4 registros de servidor de nombres

2. **Agregar registros NS al dominio padre**
   - Ve a donde se administra el DNS de `sleakops.com` (registrador, Cloudflare, etc.)
   - Crear 4 registros NS para el subdominio:

```
Tipo de Registro: NS
Nombre: qa
Valor: ns-123.awsdns-12.com
Tipo de Registro: NS
Nombre: qa
Valor: ns-456.awsdns-45.net
(repetir para los 4 servidores de nombres)
```

3. **Verificar delegaci√≥n**
   - Hacer clic en **"Verificar Delegaci√≥n"** en Sleakops
   - Esperar la propagaci√≥n DNS (usualmente 5-30 minutos)

---

## Configuraci√≥n de Dominio del Webservice

### Qu√© sucede
Los dominios de webservice (por ejemplo, `api.qa.sleakops.com`) se **configuran autom√°ticamente**.

```mermaid
graph LR
    A[Desplegar Webservice] --> B[Sleakops Crea<br/>Registro CNAME]
    B --> C[Apunta al ALB]
    C --> D[‚úÖ Listo para Usar]
    
    style A fill:#1a202c,stroke:#f2f2f2,stroke-width:2px
    style B fill:#1a202c,stroke:#2e7d32,stroke-width:2px
    style C fill:#1a202c,stroke:#2e7d32,stroke-width:2px
    style D fill:#1a202c,stroke:#90cdf4,stroke-width:3px
```


‚úÖ **No se necesita delegaci√≥n** - Sleakops autom√°ticamente:
- Crea registro CNAME en la zona alojada del entorno
- Apunta al Application Load Balancer (ALB)
- Configura certificado SSL

**¬°No necesitas hacer nada!**

---

## Configuraci√≥n de Dominio Alias

Los dominios alias requieren configuraci√≥n DNS manual en tu proveedor de dominio.

### Escenario A: El alias coincide con una zona alojada existente

**Ejemplo:** Tu alias es `api.external.com` y ya tienes `external.com` como Proveedor o Entorno en Sleakops.

```mermaid
sequenceDiagram
    participant U as T√∫
    participant S as Sleakops
    participant DNS as Tu DNS (external.com)
    participant ALB as AWS ALB
    
    U->>S: Crear Alias: api.external.com
    S-->>U: Proporcionar Registros de Validaci√≥n de Certificado
    U->>DNS: Agregar Registros CNAME de Validaci√≥n
    DNS-->>S: Certificado Validado ‚úÖ
    S-->>U: Proporcionar Endpoint ALB
    U->>DNS: Agregar CNAME al ALB
    DNS->>ALB: Tr√°fico Enrutado
    ALB-->>U: Servicio Accesible
```

#### Para Validaci√≥n de Certificado SSL

1. **Sleakops proporciona registros de validaci√≥n**
   - Ver√°s registros CNAME para validaci√≥n de certificado
   - Ejemplo:

```
_acme-challenge.api.external.com ‚Üí _validation123.acme.aws.com
```

2. **Agregar registros de validaci√≥n a tu DNS**
   - Ve a la zona alojada de `external.com` (en Sleakops o donde sea que se administre)
   - Agrega los registros CNAME exactamente como se muestra
   - Esperar validaci√≥n del certificado (usualmente 5-15 minutos)

#### Para Enrutamiento de Tr√°fico

3. **Sleakops proporciona endpoint ALB**
   - Ver√°s el nombre DNS del ALB:

```
ALB: my-alb-123456.us-east-1.elb.amazonaws.com
```

4. **Crear registro CNAME**
   - Ve a tu administraci√≥n DNS para `external.com`
   - Crear un registro CNAME:

```
Tipo de Registro: CNAME
Nombre: api
Valor: my-alb-123456.us-east-1.elb.amazonaws.com
TTL: 300
```

5. **Verificar**
   - Probar el dominio: `curl https://api.external.com`
   - Deber√≠a devolver la respuesta de tu servicio

---

### Escenario B: El alias no coincide con ninguna zona alojada

**Ejemplo:** Tu alias es `anything.com` y este dominio no se administra en Sleakops.

```mermaid
sequenceDiagram
    participant U as T√∫
    participant S as Sleakops
    participant R as Registrador (anything.com)
    participant ALB as AWS ALB
    
    U->>S: Crear Alias: anything.com
    S->>S: Crear Certificado SSL
    S-->>U: Proporcionar Registros de Validaci√≥n
    U->>R: Agregar Registros CNAME de Validaci√≥n
    R-->>S: Certificado Validado ‚úÖ
    S-->>U: Proporcionar Endpoint ALB
    U->>R: Agregar Registro CNAME/A al ALB
    R->>ALB: Tr√°fico Enrutado
    ALB-->>U: Servicio Accesible
```


#### Para Certificado SSL

1. **Sleakops crea certificado SSL**
   - Se proporcionan registros de validaci√≥n de certificado
   - Ejemplo:

```
_acme-challenge.anything.com ‚Üí _validation456.acme.aws.com
```

2. **Agregar registros de validaci√≥n**
   - Inicia sesi√≥n en tu proveedor de dominio para `anything.com`
   - Agregar los registros CNAME para validaci√≥n de certificado
   - Esperar validaci√≥n (5-15 minutos)

#### Para Enrutamiento de Tr√°fico

3. **Sleakops proporciona endpoint ALB**

```
ALB: my-alb-789012.us-east-1.elb.amazonaws.com
```

4. **Configurar DNS en tu proveedor**

    **Opci√≥n 1: CNAME (para subdominios)**

```
Tipo de Registro: CNAME
Nombre: www (o subdominio)
Valor: my-alb-789012.us-east-1.elb.amazonaws.com
```

   **Opci√≥n 2: Registro A con ALIAS (para dominio ra√≠z)**
   - Algunos proveedores soportan registros ALIAS (Route 53, Cloudflare)

```
Tipo de Registro: A (ALIAS)
Nombre: @ (ra√≠z)
Valor: my-alb-789012.us-east-1.elb.amazonaws.com
```

   **Opci√≥n 3: Registro A con IP (no recomendado)**
   - Buscar IPs del ALB y crear registros A
   - ‚ö†Ô∏è Las IPs pueden cambiar - usa CNAME cuando sea posible

5. **Verificar**
   - Probar: `curl https://anything.com`
   - Asegurar que el certificado SSL sea v√°lido

---

## Lista de Verificaci√≥n

### Dominio Proveedor/Entorno
- [ ] Servidores de nombres actualizados en el registrador
- [ ] "Verificar Delegaci√≥n" bot√≥n muestra √©xito
- [ ] La b√∫squeda DNS devuelve servidores de nombres correctos: `dig NS tudominio.com`

### Dominio Webservice
- [ ] Webservice desplegado y funcionando
- [ ] Dominio resuelve: `curl https://api.qa.sleakops.com`
- [ ] Certificado SSL v√°lido (sin advertencias del navegador)
- [ ] La b√∫squeda DNS devuelve CNAME correcto: `dig CNAME api.qa.sleakops.com`

### Dominio Alias
- [ ] Registros de validaci√≥n de certificado agregados
- [ ] Certificado muestra como validado en Sleakops
- [ ] Registro CNAME/A apunta al ALB
- [ ] Dominio resuelve: `curl https://tu-alias.com`
- [ ] La b√∫squeda DNS devuelve CNAME correcto: `dig CNAME tu-alias.com`
- [ ] Certificado SSL v√°lido

---

## Resoluci√≥n de Problemas

### "Verificar Delegaci√≥n" falla

```mermaid
graph TD
    A[Verificaci√≥n de Delegaci√≥n Falla] --> B{¬øTodos los 4 Servidores de Nombres Agregados?}
    B -->|No| C[Agregar Servidores de Nombres Faltantes]
    B -->|S√≠| D{¬øAlg√∫n Error Tipogr√°fico?}
    D -->|S√≠| E[Corregir Errores Tipogr√°ficos]
    D -->|No| F{¬øGuardado en el Registrador?}
    F -->|No| G[Guardar Cambios]
    F -->|S√≠| H[Esperar Propagaci√≥n<br/>hasta 48 horas]
    
    C --> I[Intentar de Nuevo]
    E --> I
    G --> I
    H --> I
    
    style A fill:#594440,stroke:#c62828,stroke-width:2px
    style I fill:#1a202c,stroke:#f2f2f2,stroke-width:2px
```

**Problema:** Servidores de nombres no delegados correctamente

**Soluciones:**
1. Verificar que agregaste TODOS los 4 servidores de nombres
2. Revisar errores tipogr√°ficos en los valores de los servidores de nombres
3. Esperar m√°s tiempo (la propagaci√≥n DNS puede tomar hasta 48 horas)
4. Limpiar cach√© DNS: `dig @8.8.8.8 tudominio.com`
5. Verificar en el registrador que los cambios fueron guardados

---

### Validaci√≥n de certificado atascada

**Problema:** Certificado SSL no se valida

**Soluciones:**
1. Verificar que los registros CNAME se agregaron correctamente (sin puntos extra, valores correctos)
2. Revisar que el TTL no haya expirado
3. Remover cualquier registro DNS en conflicto
4. Esperar 15-30 minutos para propagaci√≥n DNS
5. Revisar DNS: `dig _acme-challenge.tudominio.com`

---

### Dominio no resuelve

**Problema:** El dominio no carga tu servicio

**Soluciones:**
1. Verificar que el registro CNAME/A apunte al endpoint ALB correcto
2. Revisar que el ALB est√© saludable y recibiendo tr√°fico
3. Verificar que el webservice est√© desplegado y funcionando
4. Probar con `curl -v https://tudominio.com` para errores detallados
5. Revisar que los grupos de seguridad permitan tr√°fico en el puerto 443

---

### Errores de certificado SSL en el navegador

**Problema:** El navegador muestra "No Seguro" o advertencias de certificado

**Soluciones:**
1. Verificar que el certificado est√© validado en Sleakops
2. Revisar que el certificado incluya tu nombre de dominio
3. Limpiar cach√© del navegador
4. Verificar que el certificado correcto est√© adjunto al listener del ALB
5. Revisar que el certificado no haya expirado

---

## Tiempo de Propagaci√≥n DNS

| Tipo de Cambio | Tiempo T√≠pico | Tiempo M√°ximo |
|-----------------|---------------|---------------|
| Actualizaci√≥n de servidor de nombres | 15-30 minutos | 48 horas |
| Registro CNAME | 5-15 minutos | 24 horas |
| Registro A | 5-15 minutos | 24 horas |
| Validaci√≥n de certificado | 5-15 minutos | 30 minutos |

üí° **Consejo:** Usa `https://dnschecker.org` para verificar la propagaci√≥n DNS globalmente

---

## ¬øNecesitas Ayuda?

- Revisa [Niveles de Dominio y Estrategias](/docs/domain/)
- Contacta al soporte de Sleakops con los detalles de configuraci√≥n de tu dominio