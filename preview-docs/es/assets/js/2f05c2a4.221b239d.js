"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3178],{81396:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"s3-replication","title":"S3 Replication","description":"S3 replication configuration between accounts","source":"@site/tutorials/s3-replication.mdx","sourceDirName":".","slug":"/s3-replication","permalink":"/preview-docs/es/tutorial/s3-replication","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"S3","permalink":"/preview-docs/es/tutorial/tags/s-3"},{"inline":true,"label":"replication","permalink":"/preview-docs/es/tutorial/tags/replication"},{"inline":true,"label":"AWS","permalink":"/preview-docs/es/tutorial/tags/aws"},{"inline":true,"label":"cross-account","permalink":"/preview-docs/es/tutorial/tags/cross-account"},{"inline":true,"label":"data-sync","permalink":"/preview-docs/es/tutorial/tags/data-sync"},{"inline":true,"label":"backup","permalink":"/preview-docs/es/tutorial/tags/backup"},{"inline":true,"label":"storage","permalink":"/preview-docs/es/tutorial/tags/storage"}],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_label":"S3 Replication","sidebar_position":9,"title":"S3 Replication","description":"S3 replication configuration between accounts","tags":["S3","replication","AWS","cross-account","data-sync","backup","storage"],"image":"/img/tutorial-img.png"},"sidebar":"tutorialsSidebar","previous":{"title":"Third Party VPN Integration","permalink":"/preview-docs/es/tutorial/third-party-integration-vpn"},"next":{"title":"Django + Celery","permalink":"/preview-docs/es/tutorial/django-celery"}}');var s=i(74848),o=i(28453),c=i(34028),l=(i(26393),i(42644));const r={sidebar_label:"S3 Replication",sidebar_position:9,title:"S3 Replication",description:"S3 replication configuration between accounts",tags:["S3","replication","AWS","cross-account","data-sync","backup","storage"],image:"/img/tutorial-img.png"},a=void 0,d={},u=[{value:"1. Create IAM Role in the account where the source bucket is located",id:"1-create-iam-role-in-the-account-where-the-source-bucket-is-located",level:2},{value:"Trust Policy",id:"trust-policy",level:3},{value:"Permissions Policy",id:"permissions-policy",level:3},{value:"2. Add policy to the destination bucket",id:"2-add-policy-to-the-destination-bucket",level:2},{value:"3. Configure the replication rule in the source bucket",id:"3-configure-the-replication-rule-in-the-source-bucket",level:2},{value:"Optional",id:"optional",level:2},{value:"Ways to copy existing files",id:"ways-to-copy-existing-files",level:2},{value:"1. Do it along with replication",id:"1-do-it-along-with-replication",level:3},{value:"2. Use the S3 migration option provided by Sleakops",id:"2-use-the-s3-migration-option-provided-by-sleakops",level:3},{value:"3. Use the Batch Operation service",id:"3-use-the-batch-operation-service",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Steps to configure the S3 replication service to replicate files from one bucket to another in different accounts."}),"\n",(0,s.jsx)(n.p,{children:"As a requirement, versioning must be active in both buckets."}),"\n",(0,s.jsx)(c.A,{overlayBgColorEnd:"rgba(255, 255, 255, 0.8)",children:(0,s.jsx)("img",{src:"/img/tutorials/s3-replication/s3.png",alt:"s3"})}),"\n",(0,s.jsx)(n.h2,{id:"1-create-iam-role-in-the-account-where-the-source-bucket-is-located",children:"1. Create IAM Role in the account where the source bucket is located"}),"\n",(0,s.jsx)(n.h3,{id:"trust-policy",children:"Trust Policy"}),"\n",(0,s.jsx)(n.p,{children:"You need a trust policy that allows the S3 service to assume the role:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": "s3.amazonaws.com"\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"permissions-policy",children:"Permissions Policy"}),"\n",(0,s.jsx)(n.p,{children:"A permissions policy that allows:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Read objects and metadata from the source bucket (Account A)."}),"\n",(0,s.jsx)(n.li,{children:"Put objects in the destination bucket (Account B)."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "ReadSourceBucket",\n      "Effect": "Allow",\n      "Action": [\n        "s3:GetObject",\n        "s3:GetObjectAcl",\n        "s3:GetObjectVersion",\n        "s3:GetObjectVersionAcl"\n      ],\n      "Resource": "arn:aws:s3:::<SOURCE_BUCKET_NAME>/*"\n    },\n    {\n      "Sid": "WriteDestBucket",\n      "Effect": "Allow",\n      "Action": [\n        "s3:PutObject",\n        "s3:PutObjectAcl",\n        "s3:ReplicateObject",\n        "s3:ReplicateDelete",\n        "s3:ReplicateTags",\n        "s3:GetObjectVersionTagging",\n        "s3:PutObjectVersionTagging"\n      ],\n      "Resource": "arn:aws:s3:::<DESTINATION_BUCKET_NAME>/*"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"2-add-policy-to-the-destination-bucket",children:"2. Add policy to the destination bucket"}),"\n",(0,s.jsx)(n.p,{children:"In the destination bucket details, go to the permissions tab and add the following policy:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "AllowReplicationFromAccountA",\n      "Effect": "Allow",\n      "Principal": {\n        "AWS": "arn:aws:iam::<ACCOUNT_A_ID>:role/<ROLE_NAME>"\n      },\n      "Action": [\n        "s3:PutObject",\n        "s3:PutObjectAcl",\n        "s3:ReplicateObject",\n        "s3:ReplicateDelete",\n        "s3:ReplicateTags"\n      ],\n      "Resource": ["arn:aws:s3:::<DESTINATION_BUCKET_NAME>/*"]\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"3-configure-the-replication-rule-in-the-source-bucket",children:"3. Configure the replication rule in the source bucket"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:['In the source bucket details, go to the "Management" (or "Properties" depending on console version) tab and look for the ',(0,s.jsx)(n.strong,{children:"Replication"})," section."]}),"\n",(0,s.jsxs)(n.li,{children:["Create a new replication rule and define:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rule name"}),": A descriptive name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": Enabled."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Source bucket"}),": The current bucket (already selected)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Prefix/Filter"}),": You can choose to replicate the entire bucket or only a specific prefix."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Destination"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bucket"}),": specify the ",(0,s.jsx)(n.strong,{children:"ARN"})," of the destination bucket in Account B."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"IAM role"}),": choose the role you created in the first step, which allows replication."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"optional",children:"Optional"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:['If the "Transfer to destination bucket owner" option is activated, the action must be added to both AllowReplicationFromAccountA (destination bucket policy) and WriteDestBucket (IAM role):\n',(0,s.jsx)(n.code,{children:'"s3:ObjectOwnerOverrideToBucketOwner"'})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"ways-to-copy-existing-files",children:"Ways to copy existing files"}),"\n",(0,s.jsx)(n.p,{children:"There are 3 different ways to copy existing files from the bucket:"}),"\n",(0,s.jsx)(n.h3,{id:"1-do-it-along-with-replication",children:"1. Do it along with replication"}),"\n",(0,s.jsx)(n.p,{children:"When activating replication, it gives you an option to copy all existing files."}),"\n",(0,s.jsx)(n.h3,{id:"2-use-the-s3-migration-option-provided-by-sleakops",children:"2. Use the S3 migration option provided by Sleakops"}),"\n",(0,s.jsx)(n.p,{children:"In the detail of the S3 type dependency, you can find this function that guides you step by step on what needs to be done."}),"\n",(0,s.jsx)(c.A,{overlayBgColorEnd:"rgba(255, 255, 255, 0.8)",children:(0,s.jsx)("img",{src:"/img/tutorials/s3-replication/s3-2.png",alt:"s3-2"})}),"\n",(0,s.jsx)(n.h3,{id:"3-use-the-batch-operation-service",children:"3. Use the Batch Operation service"}),"\n",(0,s.jsx)(n.p,{children:"Once the replication rule is created, following these guides:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.HaR,{})," ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/batch-ops-iam-role-policies.html",children:"Batch Operations IAM role\npolicies"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.HaR,{})," ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/replication-metrics-events.html",children:"Replication metrics and\nevents"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Add to the S3ReplicationRolePolicy the following actions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'"s3:PutObjectTagging"'})," to ",(0,s.jsx)(n.code,{children:'"Sid": "WriteDestBucket"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'"s3:GetObjectTagging"'})," and ",(0,s.jsx)(n.code,{children:'"s3:ListBucket"'})," to ",(0,s.jsx)(n.code,{children:'"Sid": "ReadSourceBucket"'})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Sid": "ReadReportBucket",\n  "Effect": "Allow",\n  "Action": ["s3:GetObject", "s3:GetObjectVersion"],\n  "Resource": ["arn:aws:s3:::bucket-reports/*"]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["And add the ",(0,s.jsx)(n.code,{children:'"s3:InitiateReplication"'})," permission to both WriteDestBucket and SourceBucket."]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},26393:()=>{}}]);