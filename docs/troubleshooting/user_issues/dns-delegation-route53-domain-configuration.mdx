---
sidebar_position: 3
title: "DNS Delegation Issues with Route53 and Domain Providers"
description: "Solution for DNS delegation problems when configuring custom domains with Route53 and external domain registrars"
date: "2024-12-19"
category: "provider"
tags: ["dns", "route53", "aws", "domain", "delegation", "troubleshooting"]
---

import TroubleshootingItem from "@site/src/components/HomepageFeatures/troubleshootingitem";

# DNS Delegation Issues with Route53 and Domain Providers

**Date:** December 19, 2024  
**Category:** Provider  
**Tags:** DNS, Route53, AWS, Domain, Delegation, Troubleshooting

## Problem Description

**Context:** User is trying to configure a custom domain (ordenapp.com.ar) to point to their SleakOps deployment, but DNS delegation is not working properly despite correct Route53 configuration.

**Observed Symptoms:**

- DNS delegation appears correctly configured in Route53
- Domain registrar (DonWeb) reports delegation is configured but "not propagating because DNS servers are not configured in the hosting provider"
- NS records are not replicating properly across DNS servers
- SSL certificate validation may be failing
- Domain does not resolve to the intended AWS infrastructure

**Relevant Configuration:**

- Domain: Custom domain (.com.ar)
- DNS Provider: AWS Route53
- Domain Registrar: DonWeb (or similar)
- SSL: AWS Certificate Manager (ACM)
- Target: SleakOps deployment with Load Balancer

**Error Conditions:**

- DNS propagation fails despite correct NS delegation
- Certificate validation issues
- Domain does not resolve to target infrastructure
- NS records show inconsistent results across different DNS checkers

## Detailed Solution

<TroubleshootingItem id="verify-route53-configuration" summary="Verify Route53 Hosted Zone Configuration">

First, ensure your Route53 hosted zone is properly configured:

1. **Check Hosted Zone Creation:**

   - Go to AWS Console → Route53 → Hosted Zones
   - Verify the hosted zone for your domain exists
   - Note down the 4 NS (Name Server) records provided by AWS

2. **Verify Required Records:**

   ```
   Type: NS
   Name: your-domain.com
   Value:
   ns-123.awsdns-12.com
   ns-456.awsdns-45.net
   ns-789.awsdns-78.org
   ns-012.awsdns-01.co.uk

   Type: A
   Name: your-domain.com
   Value: [Load Balancer IP or Alias]

   Type: CNAME (for SSL validation)
   Name: _acme-challenge.your-domain.com
   Value: [ACM validation value]
   ```

</TroubleshootingItem>

<TroubleshootingItem id="domain-registrar-delegation" summary="Configure DNS Delegation at Domain Registrar">

The issue often occurs when the domain registrar's DNS delegation is incomplete:

1. **Update Name Servers at Registrar:**

   - Log into your domain registrar (DonWeb, GoDaddy, etc.)
   - Go to DNS Management or Name Servers section
   - Replace default name servers with the 4 AWS Route53 NS records
   - **Important:** Use ALL 4 name servers, not just 2

2. **Remove Conflicting DNS Records:**

   - Delete any existing A, CNAME, or other records at the registrar
   - Only keep the NS delegation records
   - Some registrars maintain their own DNS records even after delegation

3. **Wait for Propagation:**
   - DNS changes can take 24-48 hours to fully propagate
   - Use tools like `dig` or online DNS checkers to monitor progress

</TroubleshootingItem>

<TroubleshootingItem id="troubleshooting-delegation" summary="Troubleshoot DNS Delegation Issues">

If delegation still doesn't work, follow these troubleshooting steps:

1. **Check DNS Propagation:**

   ```bash
   # Check NS records from different locations
   dig NS your-domain.com @8.8.8.8
   dig NS your-domain.com @1.1.1.1

   # Check if Route53 responds
   dig A your-domain.com @ns-123.awsdns-12.com
   ```

2. **Verify with Online Tools:**

   - Use https://dnschecker.org to check global propagation
   - Check NS records specifically: `https://dnschecker.org/#NS/your-domain.com`
   - Look for inconsistencies between different regions

3. **Common Issues and Solutions:**
   - **Partial delegation**: Ensure all 4 NS records are configured
   - **TTL conflicts**: Old DNS records may be cached (wait for TTL expiry)
   - **Registrar DNS interference**: Some registrars maintain parallel DNS records

</TroubleshootingItem>

<TroubleshootingItem id="ssl-certificate-issues" summary="Resolve SSL Certificate Validation Problems">

SSL certificate issues often accompany DNS delegation problems:

1. **ACM Certificate Validation:**

   - Ensure the CNAME record for domain validation is in Route53
   - The validation record should be: `_acme-challenge.your-domain.com`
   - Value should match exactly what ACM provides

2. **Certificate Status Check:**

   ```bash
   # Check certificate validation status
   aws acm describe-certificate --certificate-arn your-cert-arn
   ```

3. **Re-request Certificate if Needed:**
   - If validation fails repeatedly, delete and re-request the certificate
   - Ensure DNS delegation is working before requesting

</TroubleshootingItem>

<TroubleshootingItem id="sleakops-specific-configuration" summary="SleakOps Domain Configuration">

For SleakOps deployments, ensure proper domain configuration:

1. **Load Balancer Configuration:**

   - Verify the A record points to the correct Load Balancer
   - Use Alias records when possible instead of IP addresses
   - Check that the Load Balancer is in the same region as Route53

2. **SleakOps Domain Settings:**

   - Update your SleakOps project configuration to use the custom domain
   - Ensure SSL certificate is properly associated
   - Verify ingress configuration accepts the new domain

3. **Testing Domain Resolution:**

   ```bash
   # Test domain resolution
   curl -I https://your-domain.com

   # Check SSL certificate
   openssl s_client -connect your-domain.com:443 -servername your-domain.com
   ```

</TroubleshootingItem>

<TroubleshootingItem id="contact-registrar-support" summary="When to Contact Domain Registrar Support">

If DNS delegation still fails after following all steps:

1. **Contact Registrar Support with Specific Information:**

   - Provide the 4 AWS Route53 name servers
   - Explain that you need complete DNS delegation (not just forwarding)
   - Ask them to verify no conflicting DNS records exist
   - Request they check their DNS servers are not overriding delegation

2. **Common Registrar Issues:**

   - Some registrars maintain "parking" DNS records
   - Incomplete delegation (only 2 NS records instead of 4)
   - DNS forwarding instead of true delegation
   - Cached old DNS records on their servers

3. **Documentation to Provide:**
   - Screenshot of Route53 hosted zone
   - Results from DNS checker tools
   - Specific error messages or symptoms

### Escalation Process:

If the registrar cannot resolve the issue:

1. **Consider Alternative Approaches:**

   - Transfer the domain to a more AWS-friendly registrar (Route53, Cloudflare, etc.)
   - Use CNAME delegation for subdomains instead of NS delegation
   - Implement DNS proxying through services like Cloudflare

2. **Alternative Solution - CNAME Approach:**

   If NS delegation fails, consider using CNAME records for subdomains:

   ```
   # At your registrar, create:
   www     CNAME    your-app.sleakops.com
   api     CNAME    your-api.sleakops.com
   ```

   This approach requires each subdomain to be individually configured but avoids NS delegation issues.

</TroubleshootingItem>

<TroubleshootingItem id="testing-and-monitoring" summary="Testing DNS delegation and ongoing monitoring">

### DNS Delegation Testing

Once delegation is configured, perform comprehensive testing:

1. **DNS Resolution Testing:**

   ```bash
   # Test from multiple DNS servers
   nslookup ordenapp.com.ar 8.8.8.8
   nslookup ordenapp.com.ar 1.1.1.1
   nslookup ordenapp.com.ar 208.67.222.222

   # Test NS record delegation
   dig NS ordenapp.com.ar @8.8.8.8

   # Test specific records
   dig A www.ordenapp.com.ar @8.8.8.8
   dig CNAME api.ordenapp.com.ar @8.8.8.8
   ```

2. **SSL Certificate Validation:**

   ```bash
   # Test SSL certificate
   echo | openssl s_client -servername ordenapp.com.ar -connect ordenapp.com.ar:443 2>/dev/null | openssl x509 -noout -dates

   # Check certificate chain
   curl -I https://ordenapp.com.ar
   ```

3. **Web-based Testing Tools:**

   - Use https://dnschecker.org/ for global DNS propagation
   - Use https://www.whatsmydns.net/ for worldwide DNS resolution
   - Use https://www.ssllabs.com/ssltest/ for SSL configuration testing

### Monitoring and Alerting

Set up monitoring to detect DNS delegation issues:

1. **CloudWatch Alarms:**

   ```yaml
   # Route53 Health Check Configuration
   Type: AWS::Route53::HealthCheck
   Properties:
     Type: HTTPS
     ResourcePath: /health
     FullyQualifiedDomainName: ordenapp.com.ar
     Port: 443
     RequestInterval: 30
     FailureThreshold: 3
   ```

2. **External Monitoring:**

   - Set up monitoring with services like Pingdom, UptimeRobot, or DataDog
   - Monitor both DNS resolution and HTTP response times
   - Alert on certificate expiration

3. **Automated DNS Validation:**

   ```bash
   #!/bin/bash
   # DNS delegation monitoring script

   DOMAIN="ordenapp.com.ar"
   EXPECTED_NS="ns-1234.awsdns-01.com"

   # Check if NS delegation is working
   CURRENT_NS=$(dig +short NS $DOMAIN @8.8.8.8 | head -1)

   if [[ "$CURRENT_NS" == *"awsdns"* ]]; then
       echo "DNS delegation working correctly"
       exit 0
   else
       echo "DNS delegation failed - NS: $CURRENT_NS"
       # Send alert notification
       exit 1
   fi
   ```

### Best Practices for DNS Management

1. **Documentation:**

   - Keep records of all DNS changes with timestamps
   - Document delegation contact information for domain registrar
   - Maintain backup of DNS configurations

2. **Change Management:**

   - Test DNS changes in staging environments first
   - Implement DNS changes during low-traffic periods
   - Have rollback procedures documented

3. **Security Considerations:**
   - Enable DNSSEC if supported by registrar
   - Use DNS monitoring to detect hijacking attempts
   - Regularly audit DNS records for unauthorized changes

</TroubleshootingItem>

---

_This FAQ was automatically generated on December 19, 2024 based on a real user query._
