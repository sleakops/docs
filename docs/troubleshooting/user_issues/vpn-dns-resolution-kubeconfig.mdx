---
sidebar_position: 3
title: "VPN DNS Resolution Issues with Kubeconfig"
description: "Solution for DNS resolution problems when connecting to EKS clusters through VPN"
date: "2024-01-15"
category: "user"
tags: ["vpn", "dns", "kubeconfig", "pritunl", "ubuntu", "lens"]
---

import TroubleshootingItem from "@site/src/components/HomepageFeatures/troubleshootingitem";

# VPN DNS Resolution Issues with Kubeconfig

**Date:** January 15, 2024  
**Category:** User  
**Tags:** VPN, DNS, Kubeconfig, Pritunl, Ubuntu, Lens

## Problem Description

**Context:** Users experience connectivity issues when trying to access EKS clusters through VPN connection using tools like Lens or kubectl. The problem is related to DNS resolution conflicts between the VPN client (Pritunl) and certain Linux distributions like Ubuntu.

**Observed Symptoms:**

- Cannot connect to EKS cluster through Lens despite being connected to VPN
- DNS resolution fails for EKS cluster endpoints
- Connection works with direct IP addresses but not with DNS names
- Issue occurs specifically on Ubuntu and similar Linux distributions

**Relevant Configuration:**

- VPN Client: Pritunl
- Operating System: Ubuntu (and similar Linux distributions)
- Cluster Access: EKS clusters in AWS
- Tools: Lens, kubectl
- Connection Method: VPN + kubeconfig

**Error Conditions:**

- Error occurs when VPN is connected
- DNS resolution fails for EKS endpoints
- Problem persists across different clusters (Dev/Prod)
- Issue is distribution-specific (Ubuntu-based systems)

## Detailed Solution

<TroubleshootingItem id="root-cause" summary="Understanding the root cause">

This issue occurs because certain Linux distributions (particularly Ubuntu) have DNS configuration conflicts when using Pritunl VPN. The system cannot properly resolve the EKS cluster DNS names through the VPN tunnel, causing connection failures.

The problem affects:

- Ubuntu and Ubuntu-based distributions
- Systems with systemd-resolved
- Configurations where VPN DNS settings conflict with local DNS

</TroubleshootingItem>

<TroubleshootingItem id="ip-replacement-solution" summary="Replace DNS names with IP addresses in kubeconfig">

The most effective solution is to replace the EKS cluster DNS endpoint with its direct IP address in your kubeconfig file.

**Steps:**

1. **Locate your kubeconfig file** (usually at `~/.kube/config`)
2. **Find the server line** that looks like:
   ```yaml
   server: https://9CFEED5AD69EF4F87D19D6FF9FBF7AD9.gr7.us-east-1.eks.amazonaws.com
   ```
3. **Replace it with the IP address:**

   ```yaml
   # For Production cluster
   server: https://10.130.96.192

   # For Development cluster
   server: https://10.110.98.134
   ```

4. **Save the file** and test the connection

**Example kubeconfig modification:**

```yaml
apiVersion: v1
clusters:
  - cluster:
      certificate-authority-data: LS0tLS1CRUdJTi...
      server: https://10.130.96.192 # Changed from DNS to IP
    name: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
contexts:
  - context:
      cluster: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
      user: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
    name: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
current-context: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
kind: Config
preferences: {}
users:
  - name: arn:aws:eks:us-east-1:123456789:cluster/my-cluster
    user:
      exec:
        apiVersion: client.authentication.k8s.io/v1beta1
        command: aws
        args:
          - eks
          - get-token
          - --cluster-name
          - my-cluster
```

</TroubleshootingItem>

<TroubleshootingItem id="pritunl-dns-reset" summary="Alternative: Reset Pritunl DNS settings">

If the IP replacement doesn't work permanently, you can try resetting the DNS and network connection in Pritunl:

**Steps:**

1. **Open Pritunl client**
2. **Look for network options** (usually in settings or connection options)
3. **Find DNS reset buttons** - there should be options to:
   - Reset DNS settings
   - Reset network connection
4. **Click both reset buttons**
5. **Reconnect to the VPN**
6. **Test cluster connectivity**

**Note:** This solution may be temporary and you might need to repeat it periodically.

</TroubleshootingItem>

<TroubleshootingItem id="lens-configuration" summary="Configuring Lens with modified kubeconfig">

When using Lens with the modified kubeconfig:

**Steps:**

1. **Ensure VPN is connected** before opening Lens
2. **Import the modified kubeconfig** with IP addresses instead of DNS names
3. **Add cluster in Lens** using the updated configuration
4. **Test connection** - you should now be able to see logs and cluster resources

**Troubleshooting Lens connection:**

- Verify VPN connection is active
- Check that the IP address in kubeconfig matches your environment (Dev/Prod)
- Ensure AWS credentials are properly configured
- Try refreshing the cluster connection in Lens

</TroubleshootingItem>

<TroubleshootingItem id="environment-specific-ips" summary="Environment-specific IP addresses">

**Important:** Different environments use different IP addresses. Make sure you're using the correct IP for each environment:

**Development Environment:**

```yaml
server: https://10.110.98.134
```

**Production Environment:**

```yaml
server: https://10.130.96.192
```

**Getting the correct IP:**
If you need to find the IP address for your specific cluster:

1. Contact SleakOps support for the current IP addresses
2. Or use `nslookup` when not connected to VPN:
   ```bash
   nslookup your-cluster-endpoint.gr7.us-east-1.eks.amazonaws.com
   ```

</TroubleshootingItem>

<TroubleshootingItem id="permanent-solution" summary="Long-term solution status">

**Current Status:** The SleakOps team is working on a permanent solution to this DNS resolution issue.

**Temporary Workaround:** The IP address replacement method described above is the current recommended workaround.

**Future Updates:** Once a permanent solution is implemented, users will be notified and can revert to using DNS names in their kubeconfig files.

**Affected Systems:**

- Ubuntu and Ubuntu-based distributions
- Systems using systemd-resolved
- Certain network configurations that conflict with Pritunl VPN

</TroubleshootingItem>

---

_This FAQ was automatically generated on January 15, 2024 based on a real user query._
