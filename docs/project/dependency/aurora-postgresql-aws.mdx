import Zoom from "react-medium-image-zoom";
import "react-medium-image-zoom/dist/styles.css";
import { FiExternalLink } from "react-icons/fi";

# AWS Aurora PostgreSQL

SleakOps provides seamless integration with Amazon Aurora PostgreSQL, a fully managed, PostgreSQL-compatible relational database service. Aurora PostgreSQL combines the performance and availability of high-end commercial databases with the simplicity and cost-effectiveness of open-source databases. By leveraging SleakOps for this integration, you can efficiently manage Aurora PostgreSQL clusters within your EKS environment, ensuring high performance, scalability, and reliability for your applications.

## FAQs 

<details>
<summary>
### How does SleakOps manage Aurora PostgreSQL credentials?
</summary>
When you create an Aurora PostgreSQL dependency in SleakOps, it automatically generates a Vargroup for your database cluster. This Variable Group securely stores the Aurora PostgreSQL credentials and other important configuration details, such as the cluster endpoint and user access information. You'll be able to manage them from the [Vargroups](/project/vargroup/index.mdx) section.
</details>

<details>
<summary>
### Can I change the Aurora PostgreSQL version after the cluster is deployed?
</summary>
Yes, Aurora PostgreSQL supports engine version upgrades. However, the upgrade process requires careful planning and may involve downtime. It's recommended to test the upgrade process in a non-production environment first.
</details>

<details>
<summary>
### What happens if I need more storage for my Aurora PostgreSQL cluster?
</summary>
Aurora PostgreSQL automatically scales storage from 10 GB up to 128 TB without requiring you to provision storage in advance. The storage scales automatically as your data grows, and you only pay for the storage you use.
</details>

<details>
<summary>
### How do I create an Aurora PostgreSQL database dump?
</summary>
To create a dump of your Aurora PostgreSQL database:
1. **Run the `pg_dump` Command**:  
```
pg_dump -h AURORA_POSTGRESQL_ADDRESS -U AURORA_POSTGRESQL_USERNAME -W > dump.sql
```
Replace `AURORA_POSTGRESQL_ADDRESS`, `AURORA_POSTGRESQL_USERNAME`, and `dump.sql` with the appropriate values.

2. **Consult Documentation**: For more information on how to create a dump, refer to the official [PostgreSQL documentation <FiExternalLink/>](https://www.postgresql.org/docs/current/app-pgdump.html).
</details>

<details>
<summary>
### How do I import an existent dump using docker?
</summary>
To import a database dump into your Aurora PostgreSQL cluster:  
1. **Connect to the VPN**: Ensure you are connected to the VPN of the AWS account where the Aurora cluster is located.
2. **Run Docker Container** (Recommended): 
   - Install Docker on your local machine if not already installed.  
   - Run a PostgreSQL Docker container with the following command:
   ```
   docker run -it --name aurora-postgresql-container -v ./initial_data/:/tmp/data/ -e POSTGRESQL_ROOT_PASSWORD=AURORA_POSTGRESQL_PASSWORD -d postgres bash
   ```
   - Attach to the container's terminal:
   ```
   docker exec -t -i aurora-postgresql-container bash
   ```
   - Import the dump file:
   ```
   psql -h AURORA_POSTGRESQL_ADDRESS -U AURORA_POSTGRESQL_USERNAME -W -f /tmp/data/dump.sql
   ```
   Replace `AURORA_POSTGRESQL_ADDRESS`, `AURORA_POSTGRESQL_USERNAME`, and `dump.sql` with your specific details.
</details>

<details>
<summary>
### How do I import an existent dump to my local machine?
</summary>
Alternatively, you can use a PostgreSQL client installed on your local machine to import the dump:
```
psql -h AURORA_POSTGRESQL_ADDRESS -U AURORA_POSTGRESQL_USERNAME -W -f /tmp/data/dump.sql
```
</details>

<details>
<summary>
### What should I do if I encounter connection issues with my Aurora PostgreSQL cluster?
</summary>
Check the following:
- Ensure the cluster endpoint, username, and password are correct.
- Verify that your security groups and firewall rules allow access.
- Ensure the cluster is running and has enough resources (CPU, memory).
- Check if the cluster is in an available state.
Otherwise, contact us.
</details>

<details>
<summary>
### What are the benefits of Aurora PostgreSQL over standard RDS PostgreSQL?
</summary>
Aurora PostgreSQL offers several advantages:
- **Performance**: Up to 3x faster than standard PostgreSQL on RDS
- **Scalability**: Automatic storage scaling up to 128 TB
- **Availability**: Continuous backup to S3 with point-in-time recovery
- **Durability**: 6-way replication across 3 Availability Zones
- **Compatibility**: PostgreSQL-compatible with minimal code changes
</details>

:::info
AWS documentation: [Amazon Aurora PostgreSQL Documentation](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/CHAP_AuroraPostgreSQL.html)
:::

## Set up your Aurora PostgreSQL
### 1. Add Aurora PostgreSQL as a Dependency
To integrate Aurora PostgreSQL with SleakOps:
1. In the SleakOps console, go to the "Dependencies" section
2. Choose "Aurora PostgreSQL" from the list of available dependency types. 
For more detail see [Dependencies: Integrating Databases, Caching, and Messaging Services](/project/dependency/index.mdx).

### 2. Set up your Aurora PostgreSQL.
You will access the following form:

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
<img
    src="/img/dependency/aurora-postgresql/aurora-postgresql-create-p1.png"
    alt="Aurora PostgreSQL create form"
/>
</Zoom>

Here the parameters that SleakOps allows you to customize during the creation:

| **Attribute** | **Description** |
| --- | --- |
| **Database Name** | Name for the Aurora PostgreSQL database. Must follow pattern: lowercase letters and numbers, cannot be "db" or "database". |
| **Database Engine Version** | Select the specific version of the Aurora PostgreSQL database engine. Choose from versions supports. Each version includes specific PostgreSQL features and security updates. |
| **Database Engine Mode** | Aurora PostgreSQL is available only in **Serverless** mode, which provides automatic scaling based on your application's needs. This mode scales compute capacity up and down automatically, making it cost-effective for variable workloads. |
| **Database Master Username** | Master username for the Aurora PostgreSQL cluster. This is the main user with administrative privileges. Cannot be "admin", "user", "database", or "name". Must start with a letter and contain only alphanumeric characters. |
| **Auto-generate Password** | If enabled, the backend will generate a strong password automatically for enhanced security. This is recommended for production environments. |
| **Database Master Password** | Password for the master user. Required if auto-generate is disabled. Must be at least 8 characters long and cannot contain @, ', ", or / characters. |
| **Minimum Aurora Capacity** | Minimum Aurora Capacity Units (0.5-256) for the serverless cluster. Each unit is approximately equal to 2GB of RAM. This sets the baseline performance level and ensures minimum resources are always available. |
| **Maximum Aurora Capacity** | Maximum Aurora Capacity Units (1-256) for the serverless cluster. Each unit is approximately equal to 2GB of RAM. This prevents the cluster from scaling beyond your budget limits while allowing performance optimization. |
| **Backup Retention Period** | Number of days (1-35) for which automatic backups are kept. Aurora PostgreSQL automatically backs up your database and stores the backups in Amazon S3. Longer retention periods provide more recovery options but increase storage costs. |
| **Backup Window** | Time period for automated backups in HH:MM-HH:MM format (UTC). Choose a time when your database activity is typically low to minimize performance impact. Aurora performs backups during this window without affecting your application. |
| **Read Replicas** | Configuration for database read replicas to improve read performance and provide additional availability. Each replica requires a unique name and can be configured as publicly accessible or private. Read replicas help distribute read traffic and provide failover capabilities. |

### 3. Customize your variable's name for your Aurora PostgreSQL cluster.

As explained, when a dependency is created, SleakOps generates a vargroup to hold all the needed attributes. 
In this step you can change the name of the attributes in case it is needed. 
SleakOps completes the values automatically. 
After this step, your dependency is created.

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
<img
    src="/img/dependency/aurora-postgresql/aurora-postgresql-create-outputs.png"
    alt="Aurora PostgreSQL create outputs"
/>
</Zoom> 