# Deployment

In Sleakops, a deployment is the final step in preparing your cloud infrastructure. Once all services are created, a [projectenv](/project) can be deployed. From Sleakops' perspective, the 'Deployment' process concludes with the execution of a Kubernetes Helm release inside the projectenv's cluster namespace.

## How SleakOps Handles Deployments

To execute the deployment, we use images saved in the project's image repository (AWS ECR), which is created when you establish the [ProjectEnv](/project). Initially, Sleakops creates the image with [Kaniko <FiExternalLink/> ](https://github.com/GoogleContainerTools/kaniko) and pushes it the moment you establish a [Build ](/project/build). Additionally, at the time of the Deployment, we pull the image corresponding to the Build being deployed. 

The subsequent step involves creating the Helm chart. We modify some general purpose-built Helm templates by applying the required values based on the services you've created and their configurations. For instance, a Kubernetes service, ingress, workers, and other Services are created. After building the Helm Chart, we upload it to the ECR and use it to establish a Helm Release.

:::info

All these resources reside in your own AWS Accounts. Sleakops does not exclusively store any data.

:::

## How to Create a Deployment

As of now, to execute a Deployment, you must make this call 'indirectly' unless you use the Deployment CLI. However, multiple methods exist for deploying, as shown [below ](#running-a-deploy). Be aware that we enforce some Deployments to maximize uptime and ensure the current state of the deployed infrastructure remains unaffected.

:::caution Forced Deployment

Currently, in certain scenarios, Sleakops enforces some Deployments. Read [here ](#forced-deployments) to understand when and why we do this.

:::

### Running a Deploy {#running-a-deploy}

If it's not a forced deployment, we'll show you a switcher to decide if you want to deploy your changes.

- [Service](/service/index.mdx): Allows you to decide whether to Deploy the changes unless you modify the 'alias' configuration, which forces a deployment. This Deployment always creates a new Helm chart.
- [VariableGroup](/vargroup): Functions similar to Services but does not create a new Helm chart. It only changes the [values ](https://helm.sh/docs/chart_best_practices/values/) of the Deployment.
- [Dependency](/dependency): Enforces a Deployment to deploy its related VariableGroup, which your Services might require to function.

<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
  <img src="/img/deployment/DEPLOY-deploy-switcher.png" alt="DEPLOY-deploy-switcher" style={{ height: '125px', width: 'auto' }}/>
</Zoom>

If you don't deploy your changes when you make them or if your change doesn't force a deployment, then you have two ways to execute a Deployment:

- [Build section](/project/build): From the Deploy button, you can select which Build you wish to deploy.
<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
  <img src="/img/deployment/DEPLOY-build-button.png" alt="DEPLOY-build-button" style={{ height: '250px', width: 'auto' }}/>
</Zoom>

- Unpublished Changes Banner: This banner appears when something is yet to be deployed on the cluster. Using this banner, you can opt to deploy only the VariableGroups and not the Services in 'draft' state.
<Zoom overlayBgColorEnd="rgba(255, 255, 255, 0.8)">
  <img src="/img/deployment/DEPLOY-deploy-changes-banner.png" alt="DEPLOY-deploy-changes-banner" style={{ height: '350px', width: 'auto' }}/>
</Zoom>

#### Forced Deployments {#forced-deployments}

For clarification, forced deployments are sometimes necessary to minimize the downtime of the services deployed on the Cluster and also to ensure your services function properly. This is because the Helm templates should always be updated with the Kubernetes Secrets existing in the namespace to avoid failures. The actions that will enforce a deployment are:

- Service Alias configuration changes: Required to update the Kubernetes Ingress resource.
- Dependency deletion: Necessary to update the templates with the deletion of its related VariableGroup/Secret.
- VariableGroup deletion: Functions the same as Dependency deletion.

## Cloud Resources

When you create a deployment in Sleakops, the associated cluster will receive these Kubernetes entities:

- Release for each Sleakops release
- Deployment for each web-service and worker Sleakops service types
- Service for each web-service Sleakops service type
- Ingress for each web-service Sleakops service type
- HPA (Horizontal Pod Autoscaler) for each Sleakops service
- Job for each job-service Sleakops service type
- CronJob for each cronjob-service Sleakops service type
